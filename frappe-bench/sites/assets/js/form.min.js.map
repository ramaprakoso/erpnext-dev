{"version":3,"file":"form.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/form/document_follow.js","../../../apps/frappe/frappe/public/js/frappe/views/formview.js","../../../apps/frappe/frappe/public/js/legacy/form.js","../../../apps/frappe/frappe/public/js/legacy/client_script_helpers.js","../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js","../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js","../../../apps/frappe/frappe/public/js/frappe/form/document_flow.js","../../../apps/frappe/frappe/public/js/frappe/form/save.js","../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js","../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js","../../../apps/frappe/frappe/public/js/frappe/form/workflow.js","../../../apps/frappe/frappe/public/js/frappe/form/print.js","../../../apps/frappe/frappe/public/js/frappe/form/form_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/form/user_image.js","../../../apps/frappe/frappe/public/js/frappe/form/share.js","../../../apps/frappe/frappe/public/js/frappe/form/review.js","../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/attachments.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/timeline.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/assign_to.js","../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js","../../../apps/frappe/frappe/public/js/frappe/form/success_action.js","../../../apps/frappe/frappe/public/js/frappe/meta_tag.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.ui.form');\n\nfrappe.ui.form.DocumentFollow = class DocumentFollow {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.follow_document_link = this.parent.find('.follow-document-link');\n\t\tthis.unfollow_document_link = this.parent.find('.unfollow-document-link');\n\t\tthis.follow_span = this.parent.find('.anchor-document-follow > span');\n\t\tthis.followed_by = this.parent.find('.followed-by');\n\t\tthis.followed_by_label = this.parent.find('.followed-by-label');\n\t}\n\n\trefresh() {\n\t\tthis.set_followers();\n\t\tthis.render_sidebar();\n\t}\n\n\trender_sidebar() {\n\t\tconst docinfo = this.frm.get_docinfo();\n\t\tconst document_follow_enabled = frappe.boot.user.document_follow_notify;\n\t\tconst document_can_be_followed = frappe.get_meta(this.frm.doctype).track_changes;\n\t\tif (frappe.session.user === 'Administrator'\n\t\t\t|| !document_follow_enabled\n\t\t\t|| !document_can_be_followed\n\t\t) {\n\t\t\tthis.hide_follow_section();\n\t\t\treturn;\n\t\t}\n\t\tthis.bind_events();\n\n\t\tconst is_followed = docinfo && docinfo.is_document_followed;\n\n\t\tif(is_followed > 0) {\n\t\t\tthis.unfollow_document_link.removeClass('hidden');\n\t\t\tthis.follow_document_link.addClass('hidden');\n\t\t} else {\n\t\t\tthis.followed_by_label.addClass('hidden');\n\t\t\tthis.followed_by.addClass('hidden');\n\t\t\tthis.unfollow_document_link.addClass('hidden');\n\t\t\tthis.follow_document_link.removeClass('hidden');\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.follow_document_link.on('click', () => {\n\t\t\tthis.follow_document_link.addClass('text-muted disable-click');\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.desk.form.document_follow.follow_document',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': this.frm.doctype,\n\t\t\t\t\t'doc_name': this.frm.doc.name,\n\t\t\t\t\t'user': frappe.session.user,\n\t\t\t\t\t'force': true\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tthis.follow_action();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.unfollow_document_link.on('click', () => {\n\t\t\tthis.unfollow_document_link.addClass('text-muted disable-click');\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.desk.form.document_follow.unfollow_document',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': this.frm.doctype,\n\t\t\t\t\t'doc_name': this.frm.doc.name,\n\t\t\t\t\t'user': frappe.session.user\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\tthis.unfollow_action();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thide_follow_section() {\n\t\tthis.parent.hide();\n\t}\n\n\tset_followers() {\n\t\tthis.followed_by.removeClass('hidden');\n\t\tthis.followed_by_label.removeClass('hidden');\n\t\tthis.followed_by.empty();\n\t\tthis.get_followed_user().then(user => {\n\t\t\t$(user).appendTo(this.followed_by);\n\t\t});\n\t}\n\n\tget_followed_user() {\n\t\tvar html = '';\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'frappe.desk.form.document_follow.get_follow_users',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': this.frm.doctype,\n\t\t\t\t\t'doc_name': this.frm.doc.name,\n\t\t\t\t},\n\t\t\t}).then(r => {\n\t\t\t\tthis.count_others = 0;\n\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\tthis.count_others++;\n\t\t\t\t\tif(this.count_others < 4){\n\t\t\t\t\t\thtml += frappe.avatar(r.message[d].user, 'avatar-small');\n\t\t\t\t\t}\n\t\t\t\t\tif(this.count_others === 0){\n\t\t\t\t\t\tthis.followed_by.addClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve(html);\n\t\t\t});\n\t\t});\n\t}\n\n\tfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You are now following this document. You will receive daily updates via email. You can change this in User Settings.'),\n\t\t\tindicator: 'orange'\n\t\t});\n\t\tthis.follow_document_link.removeClass('text-muted disable-click');\n\t\tthis.follow_document_link.addClass('hidden');\n\t\tthis.unfollow_document_link.removeClass('hidden');\n\t\tthis.set_followers();\n\t}\n\n\tunfollow_action() {\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You unfollowed this document'),\n\t\t\tindicator: 'red'\n\t\t});\n\t\tthis.unfollow_document_link.removeClass('text-muted disable-click');\n\t\tthis.unfollow_document_link.addClass('hidden');\n\t\tthis.follow_document_link.removeClass('hidden');\n\t\tthis.followed_by.addClass('hidden');\n\t\tthis.followed_by_label.addClass('hidden');\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.formview');\n\nfrappe.views.FormFactory = class FormFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tvar me = this,\n\t\t\tdt = route[1];\n\n\t\tif(!frappe.views.formview[dt]) {\n\t\t\tfrappe.model.with_doctype(dt, function() {\n\t\t\t\tme.page = frappe.container.add_page(\"Form/\" + dt);\n\t\t\t\tfrappe.views.formview[dt] = me.page;\n\t\t\t\tme.page.frm = new _f.Frm(dt, me.page, true);\n\t\t\t\tme.show_doc(route);\n\t\t\t});\n\t\t} else {\n\t\t\tme.show_doc(route);\n\t\t}\n\n\t\tif(!this.initialized) {\n\t\t\t$(document).on(\"page-change\", function() {\n\t\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"new_communication\", function(data) {\n\t\t\t\tfrappe.timeline.new_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"delete_communication\", function(data) {\n\t\t\t\tfrappe.timeline.delete_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on('update_communication', function(data) {\n\t\t\t\tfrappe.timeline.update_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"doc_viewers\", function(data) {\n\t\t\t\tfrappe.ui.form.set_viewers(data);\n\t\t\t});\n\t\t}\n\n\n\t\tthis.initialized = true;\n\t}\n\n\tshow_doc(route) {\n\t\tvar dt = route[1],\n\t\t\tdn = route.slice(2).join(\"/\"),\n\t\t\tme = this;\n\n\t\tif(frappe.model.new_names[dn]) {\n\t\t\tdn = frappe.model.new_names[dn];\n\t\t\tfrappe.set_route(\"Form\", dt, dn);\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.with_doc(dt, dn, function(dn, r) {\n\t\t\tif(r && r['403']) return; // not permitted\n\n\t\t\tif(!(locals[dt] && locals[dt][dn])) {\n\t\t\t\t// doc not found, but starts with New,\n\t\t\t\t// make a new doc and set it\n\t\t\t\tvar new_str = __(\"New\") + \" \";\n\t\t\t\tif(dn && dn.substr(0, new_str.length)==new_str) {\n\t\t\t\t\tvar new_name = frappe.model.make_new_doc_and_get_name(dt, true);\n\t\t\t\t\tif(new_name===dn) {\n\t\t\t\t\t\tme.load(dt, dn);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", dt, new_name)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_not_found(route);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.load(dt, dn);\n\t\t});\n\t}\n\n\tload(dt, dn) {\n\t\tfrappe.container.change_to(\"Form/\" + dt);\n\t\tfrappe.views.formview[dt].frm.refresh(dn);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n/* Form page structure\n\n\t+ this.parent (either FormContainer or Dialog)\n\t\t+ this.wrapper\n\t\t\t+ this.toolbar\n\t\t\t+ this.form_wrapper\n\t\t\t\t\t+ this.head\n\t\t\t\t\t+ this.body\n\t\t\t\t\t\t+ this.layout\n\t\t\t\t+ this.sidebar\n\t\t\t+ this.footer\n*/\n\n/* eslint-disable no-console */\n\nfrappe.provide('_f');\nfrappe.provide('frappe.ui.form');\n\nfrappe.ui.form.Controller = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t}\n});\n\n_f.frms = {};\n\n_f.Frm = function(doctype, parent, in_form) {\n\tthis.docname = '';\n\tthis.doctype = doctype;\n\tthis.hidden = false;\n\tthis.refresh_if_stale_for = 120;\n\n\tvar me = this;\n\tthis.opendocs = {};\n\tthis.custom_buttons = {};\n\tthis.sections = [];\n\tthis.grids = [];\n\tthis.cscript = new frappe.ui.form.Controller({frm:this});\n\tthis.events = {};\n\tthis.pformat = {};\n\tthis.fetch_dict = {};\n\tthis.parent = parent;\n\tthis.tinymce_id_list = [];\n\n\tthis.setup_meta(doctype);\n\n\t// show in form instead of in dialog, when called using url (router.js)\n\tthis.in_form = in_form ? true : false;\n\n\t// notify on rename\n\t$(document).on('rename', function(event, dt, old_name, new_name) {\n\t\tif(dt==me.doctype)\n\t\t\tme.rename_notify(dt, old_name, new_name);\n\t});\n};\n\n_f.Frm.prototype.check_doctype_conflict = function(docname) {\n\tif(this.doctype=='DocType' && docname=='DocType') {\n\t\tfrappe.msgprint(__('Allowing DocType, DocType. Be careful!'));\n\t} else if(this.doctype=='DocType') {\n\t\tif (frappe.views.formview[docname] || frappe.pages['List/'+docname]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t} else {\n\t\tif (frappe.views.formview.DocType && frappe.views.formview.DocType.frm.opendocs[this.doctype]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.setup = function() {\n\tthis.fields = [];\n\tthis.fields_dict = {};\n\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t// wrapper\n\tthis.wrapper = this.parent;\n\tthis.$wrapper = $(this.wrapper);\n\tfrappe.ui.make_app_page({\n\t\tparent: this.wrapper,\n\t\tsingle_column: this.meta.hide_toolbar\n\t});\n\tthis.page = this.wrapper.page;\n\tthis.layout_main = this.page.main.get(0);\n\n\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\tfrm: this,\n\t\tpage: this.page\n\t});\n\n\t// print layout\n\tthis.setup_print_layout();\n\n\t// 2 column layout\n\tthis.setup_std_layout();\n\n\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\tfrm: this\n\t});\n\tthis.script_manager.setup();\n\tthis.watch_model_updates();\n\n\tif(!this.meta.hide_toolbar) {\n\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\tfrm: this,\n\t\t\tparent: $('<div>').appendTo(this.page.main.parent())\n\t\t});\n\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t}\n\tthis.setup_drag_drop();\n\n\tthis.setup_done = true;\n};\n\n_f.Frm.prototype.setup_drag_drop = function() {\n\tvar me = this;\n\tthis.$wrapper.on('dragenter dragover', false)\n\t\t.on('drop', function(e) {\n\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif(me.doc.__islocal) {\n\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tif(me.attachments.max_reached()) {\n\t\t\t\tfrappe.msgprint(__(\"Maximum Attachment Limit for this record reached.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tdocname: me.docname,\n\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\ton_success(file_doc) {\n\t\t\t\t\tme.attachments.attachment_uploaded(file_doc);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n};\n\n_f.Frm.prototype.setup_print_layout = function() {\n\tvar me = this;\n\tthis.print_preview = new frappe.ui.form.PrintPreview({\n\t\tfrm: this\n\t});\n\n\t// show edit button for print view\n\tthis.page.wrapper.on('view-change', function() {\n\t\tme.toolbar.set_primary_action();\n\t});\n};\n\n_f.Frm.prototype.print_doc = function() {\n\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\tthis.hide_print();\n\t\treturn;\n\t}\n\tif(!frappe.model.can_print(this.doc.doctype, this)) {\n\t\tfrappe.msgprint(__(\"You are not allowed to print this document\"));\n\t\treturn;\n\t}\n\n\tthis.print_preview.refresh_print_options().trigger(\"change\");\n\tthis.page.set_view(\"print\");\n\tthis.print_preview.set_user_lang();\n\tthis.print_preview.set_default_print_language();\n\tthis.print_preview.preview();\n};\n\n_f.Frm.prototype.hide_print = function() {\n\tif(this.setup_done && this.page.current_view_name===\"print\") {\n\t\tthis.page.set_view(this.page.previous_view_name===\"print\" ?\n\t\t\t\"main\" : (this.page.previous_view_name || \"main\"));\n\t}\n};\n\n_f.Frm.prototype.watch_model_updates = function() {\n\t// watch model updates\n\tvar me = this;\n\n\t// on main doc\n\tfrappe.model.on(me.doctype, \"*\", function(fieldname, value, doc) {\n\t\t// set input\n\t\tif(doc.name===me.docname) {\n\t\t\tif ((value==='' || value===null) && !doc[fieldname]) {\n\t\t\t\t// both the incoming and outgoing values are falsy\n\t\t\t\t// the texteditor, summernote, changes nulls to empty strings on render,\n\t\t\t\t// so ignore those changes\n\t\t\t} else {\n\t\t\t\tme.dirty();\n\t\t\t}\n\t\t\tme.fields_dict[fieldname]\n\t\t\t\t&& me.fields_dict[fieldname].refresh(fieldname);\n\n\t\t\tme.layout.refresh_dependency();\n\t\t\tlet object = me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\treturn object;\n\t\t}\n\t});\n\n\t// on table fields\n\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {\n\t\tfieldtype: [\"in\", frappe.model.table_fields]\n\t});\n\n\t// using $.each to preserve df via closure\n\t$.each(table_fields, function(i, df) {\n\t\tfrappe.model.on(df.options, \"*\", function(fieldname, value, doc) {\n\t\t\tif(doc.parent===me.docname && doc.parentfield===df.fieldname) {\n\t\t\t\tme.dirty();\n\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\tme.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n\t});\n};\n\n_f.Frm.prototype.setup_std_layout = function() {\n\tthis.form_wrapper \t= $('<div></div>').appendTo(this.layout_main);\n\tthis.body \t\t\t= $('<div></div>').appendTo(this.form_wrapper);\n\n\t// only tray\n\tthis.meta.section_style='Simple'; // always simple!\n\n\t// layout\n\tthis.layout = new frappe.ui.form.Layout({\n\t\tparent: this.body,\n\t\tdoctype: this.doctype,\n\t\tfrm: this,\n\t\twith_dashboard: true\n\t});\n\tthis.layout.make();\n\n\tthis.fields_dict = this.layout.fields_dict;\n\tthis.fields = this.layout.fields_list;\n\n\tthis.document_flow = new frappe.ui.form.DocumentFlow({\n\t\tfrm: this\n\t});\n\n\tthis.dashboard = new frappe.ui.form.Dashboard({\n\t\tfrm: this,\n\t});\n\n\t// state\n\tthis.states = new frappe.ui.form.States({\n\t\tfrm: this\n\t});\n};\n\n// email the form\n_f.Frm.prototype.email_doc = function(message) {\n\tnew frappe.views.CommunicationComposer({\n\t\tdoc: this.doc,\n\t\tfrm: this,\n\t\tsubject: __(this.meta.name) + ': ' + this.docname,\n\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\tattach_document_print: true,\n\t\tmessage: message,\n\t\treal_name: this.doc.real_name || this.doc.contact_display || this.doc.contact_name\n\t});\n};\n\n// rename the form\n_f.Frm.prototype.rename_doc = function() {\n\tfrappe.model.rename_doc(this.doctype, this.docname);\n};\n\n_f.Frm.prototype.share_doc = function() {\n\tthis.shared.show();\n};\n\n// notify this form of renamed records\n_f.Frm.prototype.rename_notify = function(dt, old, name) {\n\t// from form\n\tif(this.meta.istable)\n\t\treturn;\n\n\tif(this.docname == old)\n\t\tthis.docname = name;\n\telse\n\t\treturn;\n\n\t// cleanup\n\tif(this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t// delete docfield copy\n\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t}\n\n\tdelete this.opendocs[old];\n\tthis.opendocs[name] = true;\n\n\tif(this.meta.in_dialog || !this.in_form) {\n\t\treturn;\n\t}\n\n\tfrappe.re_route[window.location.hash] = '#Form/' + encodeURIComponent(this.doctype) + '/' + encodeURIComponent(name);\n\tfrappe.set_route('Form', this.doctype, name);\n};\n\n// SETUP\n\n_f.Frm.prototype.setup_meta = function() {\n\tthis.meta = frappe.get_doc('DocType', this.doctype);\n\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\tif(this.meta.istable) {\n\t\tthis.meta.in_dialog = 1;\n\t}\n};\n\n_f.Frm.prototype.refresh_header = function(is_a_different_doc) {\n\t// set title\n\t// main title\n\tif(!this.meta.in_dialog || this.in_form) {\n\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t}\n\n\t// show / hide buttons\n\tif(this.toolbar) {\n\t\tif (is_a_different_doc) {\n\t\t\tthis.toolbar.current_status = undefined;\n\t\t}\n\n\t\tthis.toolbar.refresh();\n\t}\n\n\tthis.document_flow.refresh();\n\tthis.dashboard.refresh();\n\n\tif(this.meta.is_submittable\n\t\t&& this.perm[0] && this.perm[0].submit\n\t\t&& !this.is_dirty()\n\t\t&& !this.is_new()\n\t\t&& !frappe.model.has_workflow(this.doctype) // show only if no workflow\n\t\t&& this.doc.docstatus===0) {\n\t\tthis.dashboard.add_comment(__('Submit this document to confirm'), 'blue', true);\n\t}\n\n\tthis.clear_custom_buttons();\n\n\tthis.show_web_link();\n};\n\n_f.Frm.prototype.show_web_link = function() {\n\tvar doc = this.doc, me = this;\n\tif(!doc.__islocal && doc.__onload && doc.__onload.is_website_generator) {\n\t\tme.web_link && me.web_link.remove();\n\t\tif(doc.__onload.published) {\n\t\t\tme.add_web_link(\"/\" + doc.route);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.add_web_link = function(path, label) {\n\tlabel = label || \"See on Website\";\n\tthis.web_link = this.sidebar.add_user_action(__(label),\n\t\tfunction() {}).attr(\"href\", path || this.doc.route).attr(\"target\", \"_blank\");\n};\n\n_f.Frm.prototype.check_doc_perm = function() {\n\t// get perm\n\tvar dt = this.parent_doctype?this.parent_doctype : this.doctype;\n\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\n\tif(!this.perm[0].read) {\n\t\treturn 0;\n\t}\n\treturn 1;\n};\n\n_f.Frm.prototype.refresh = function(docname) {\n\tvar is_a_different_doc = docname ? true : false;\n\n\tif(docname) {\n\t\t// record switch\n\t\tif(this.docname != docname && (!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\t\tfrappe.utils.scroll_to(0);\n\t\t\tthis.hide_print();\n\t\t}\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach(grid_obj => grid_obj.grid.visible_columns = null);\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.docname = docname;\n\t}\n\n\tcur_frm = this;\n\n\tif(this.docname) { // document to show\n\n\t\t// set the doc\n\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t// check permissions\n\t\tif(!this.check_doc_perm()) {\n\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(this.docname));\n\t\t\treturn;\n\t\t}\n\n\t\t// read only (workflow)\n\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\tif (this.read_only) this.set_read_only(true);\n\n\t\t// check if doctype is already open\n\t\tif (!this.opendocs[this.docname]) {\n\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t} else {\n\t\t\tif(this.doc && (!this.doc.__unsaved) && this.doc.__last_sync_on &&\n\t\t\t\t(new Date() - this.doc.__last_sync_on) > (this.refresh_if_stale_for * 1000)) {\n\t\t\t\tthis.reload_doc();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// do setup\n\t\tif(!this.setup_done) {\n\t\t\tthis.setup();\n\t\t}\n\n\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\tthis.cscript.is_onload = false;\n\t\tif(!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.setnewdoc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on('hide',  function() {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(is_a_different_doc);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\n\t\t// if print format is shown, refresh the format\n\t\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\tthis.print_preview.preview();\n\t\t}\n\n\t\tif(is_a_different_doc) {\n\t\t\tif(this.show_print_first && this.doc.docstatus===1) {\n\t\t\t\t// show print view\n\t\t\t\tthis.print_doc();\n\t\t\t}\n\t\t}\n\n\t\t// set status classes\n\t\tthis.$wrapper.removeClass('validated-form')\n\t\t\t.toggleClass('editable-form', this.doc.docstatus===0)\n\t\t\t.toggleClass('submitted-form', this.doc.docstatus===1)\n\t\t\t.toggleClass('cancelled-form', this.doc.docstatus===2);\n\n\t\tthis.show_if_needs_refresh();\n\t}\n};\n\n_f.Frm.prototype.show_if_needs_refresh = function() {\n\tif(this.doc.__needs_refresh) {\n\t\tif(this.doc.__unsaved) {\n\t\t\tthis.dashboard.clear_headline();\n\t\t\tthis.dashboard.set_headline_alert(__(\"This form has been modified after you have loaded it\")\n\t\t\t\t+ '<a class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">'\n\t\t\t\t+ __(\"Refresh\") + '</a>', \"alert-warning\");\n\t\t} else {\n\t\t\tthis.reload_doc();\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.render_form = function(is_a_different_doc) {\n\tif(!this.meta.istable) {\n\t\tthis.layout.doc = this.doc;\n\t\tthis.layout.attach_doc_and_docfields();\n\n\t\tthis.sidebar = new frappe.ui.form.Sidebar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page\n\t\t});\n\t\tthis.sidebar.make();\n\n\t\t// clear layout message\n\t\tthis.layout.show_message();\n\n\t\tfrappe.run_serially([\n\t\t\t// header must be refreshed before client methods\n\t\t\t// because add_custom_button\n\t\t\t() => this.refresh_header(is_a_different_doc),\n\t\t\t// trigger global trigger\n\t\t\t// to use this\n\t\t\t() => $(document).trigger('form-refresh', [this]),\n\t\t\t// fields\n\t\t\t() => this.refresh_fields(),\n\t\t\t// call trigger\n\t\t\t() => this.script_manager.trigger(\"refresh\"),\n\t\t\t// call onload post render for callbacks to be fired\n\t\t\t() => {\n\t\t\t\tif(this.cscript.is_onload) {\n\t\t\t\t\treturn this.script_manager.trigger(\"onload_post_render\");\n\t\t\t\t}\n\t\t\t},\n\t\t\t() => this.dashboard.after_refresh()\n\t\t]);\n\t\t// focus on first input\n\n\t\tif(this.is_new()) {\n\t\t\tvar first = this.form_wrapper.find('.form-layout input:first');\n\t\t\tif(!in_list([\"Date\", \"Datetime\"], first.attr(\"data-fieldtype\"))) {\n\t\t\t\tfirst.focus();\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthis.refresh_header(is_a_different_doc);\n\t}\n\n\tthis.$wrapper.trigger('render_complete');\n\n\tif(!this.hidden) {\n\t\tthis.layout.show_empty_form_message();\n\t}\n\n\tthis.scroll_to_element();\n};\n\n_f.Frm.prototype.refresh_field = function(fname) {\n\tif(this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\tthis.fields_dict[fname].refresh();\n\t\tthis.layout.refresh_dependency();\n\t}\n};\n\n_f.Frm.prototype.refresh_fields = function() {\n\tthis.layout.refresh(this.doc);\n\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t// cleanup activities after refresh\n\tthis.cleanup_refresh(this);\n};\n\n\n_f.Frm.prototype.cleanup_refresh = function() {\n\tvar me = this;\n\tif(me.fields_dict['amended_from']) {\n\t\tif (me.doc.amended_from) {\n\t\t\tunhide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) unhide_field('amendment_date');\n\t\t} else {\n\t\t\thide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) hide_field('amendment_date');\n\t\t}\n\t}\n\n\tif(me.fields_dict['trash_reason']) {\n\t\tif(me.doc.trash_reason && me.doc.docstatus == 2) {\n\t\t\tunhide_field('trash_reason');\n\t\t} else {\n\t\t\thide_field('trash_reason');\n\t\t}\n\t}\n\n\tif(me.meta.autoname && me.meta.autoname.substr(0,6)=='field:' && !me.doc.__islocal) {\n\t\tvar fn = me.meta.autoname.substr(6);\n\n\t\tif (me.doc[fn]) {\n\t\t\tme.toggle_display(fn, false);\n\t\t}\n\t}\n\n\tif(me.meta.autoname==\"naming_series:\" && !me.doc.__islocal) {\n\t\tme.toggle_display(\"naming_series\", false);\n\t}\n};\n\n_f.Frm.prototype.setnewdoc = function() {\n\t// moved this call to refresh function\n\t// this.check_doctype_conflict(docname);\n\tvar me = this;\n\n\t// hide any open grid\n\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname)\n\t\t.then(() => {\n\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\tme.opendocs[me.docname] = true;\n\t\t\tme.render_form();\n\n\t\t\tfrappe.after_ajax(function() {\n\t\t\t\tme.trigger_link_fields();\n\t\t\t});\n\n\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t});\n\n\t// update seen\n\tif(this.meta.track_seen) {\n\t\t$('.list-id[data-name=\"'+ me.docname +'\"]').addClass('seen');\n\t}\n};\n\n_f.Frm.prototype.trigger_link_fields = function() {\n\t// trigger link fields which have default values set\n\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t$.each(this.fields_dict, function(fieldname, field) {\n\t\t\tif (field.df.fieldtype==\"Link\" && this.doc[fieldname]) {\n\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\tfield.set_value(this.doc[fieldname]);\n\t\t\t}\n\t\t});\n\n\t\tdelete this.doc.__run_link_triggers;\n\t}\n};\n\n_f.Frm.prototype.runscript = function(scriptname, callingfield, onrefresh) {\n\tvar me = this;\n\tif(this.docname) {\n\t\t// send to run\n\t\tif(callingfield)\n\t\t\t$(callingfield.input).set_working();\n\n\t\tfrappe.call({\n\t\t\tmethod: \"runserverobj\",\n\t\t\targs: {'docs':this.doc, 'method':scriptname },\n\t\t\tbtn: callingfield.$input,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(onrefresh) {\n\t\t\t\t\t\tonrefresh(r);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.copy_doc = function(onload, from_amend) {\n\tthis.validate_form_action(\"Create\");\n\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\tnewdoc.idx = null;\n\tnewdoc.__run_link_triggers = false;\n\tif(onload) {\n\t\tonload(newdoc);\n\t}\n\tfrappe.set_route('Form', newdoc.doctype, newdoc.name);\n};\n\n_f.Frm.prototype.reload_doc = function() {\n\tthis.check_doctype_conflict(this.docname);\n\n\tvar me = this;\n\n\tif(!me.doc.__islocal) {\n\t\tfrappe.model.remove_from_locals(me.doctype, me.docname);\n\t\tfrappe.model.with_doc(me.doctype, me.docname, function() {\n\t\t\tme.refresh();\n\t\t});\n\t}\n};\n\nfrappe.validated = 0;\n// Proxy for frappe.validated\nObject.defineProperty(window, 'validated', {\n\tget: function() {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\treturn frappe.validated;\n\t},\n\tset: function(value) {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\tfrappe.validated = value;\n\t\treturn frappe.validated;\n\t}\n});\n\n_f.Frm.prototype.save = function(save_action, callback, btn, on_error) {\n\tlet me = this;\n\treturn new Promise((resolve, reject) => {\n\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t$(document.activeElement).blur();\n\n\t\tfrappe.ui.form.close_grid_form();\n\t\t// let any pending js process finish\n\t\tsetTimeout(function() {\n\t\t\tme._save(save_action, callback, btn, on_error, resolve, reject);\n\t\t}, 100);\n\t}).then(() => {\n\t\tme.show_success_action();\n\t}).catch((e) => {\n\t\tconsole.error(e);\n\t});\n};\n\n_f.Frm.prototype._save = function(save_action, callback, btn, on_error, resolve, reject) {\n\tvar me = this;\n\tif(!save_action) save_action = \"Save\";\n\tthis.validate_form_action(save_action, resolve);\n\n\tif((!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\tfrappe.utils.scroll_to(0);\n\t}\n\tvar after_save = function(r) {\n\t\tif(!r.exc) {\n\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action)!==-1) {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t}\n\n\t\t\tme.script_manager.trigger(\"after_save\");\n\t\t\tme.refresh();\n\t\t} else {\n\t\t\tif(on_error) {\n\t\t\t\ton_error();\n\t\t\t\treject();\n\t\t\t}\n\t\t}\n\t\tcallback && callback(r);\n\t\tresolve();\n\t};\n\n\tvar fail = () => {\n\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\tif(on_error) {\n\t\t\ton_error();\n\t\t\treject();\n\t\t}\n\t};\n\n\tif(save_action != \"Update\") {\n\t\t// validate\n\t\tfrappe.validated = true;\n\t\tfrappe.run_serially([\n\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t() => {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\tfail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t}\n\t\t]).catch(fail);\n\t} else {\n\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t}\n};\n\n\n_f.Frm.prototype.savesubmit = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\treturn new Promise(resolve => {\n\t\tthis.validate_form_action(\"Submit\");\n\t\tfrappe.confirm(__(\"Permanently Submit {0}?\", [this.docname]), function() {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_submit\").then(function() {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.save('Submit', function(r) {\n\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\thandle_fail();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"on_submit\")\n\t\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t\t}\n\t\t\t\t}, btn, () => handle_fail(), resolve);\n\t\t\t});\n\t\t}, () => handle_fail() );\n\t});\n};\n\n_f.Frm.prototype.savecancel = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\tthis.validate_form_action('Cancel');\n\tfrappe.confirm(__(\"Permanently Cancel {0}?\", [this.docname]), function() {\n\t\tfrappe.validated = true;\n\t\tme.script_manager.trigger(\"before_cancel\").then(function() {\n\t\t\tif(!frappe.validated) {\n\t\t\t\thandle_fail();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar after_cancel = function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t}\n\t\t\t};\n\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t});\n\t}, () => handle_fail());\n};\n\n// delete the record\n_f.Frm.prototype.savetrash = function() {\n\tthis.validate_form_action(\"Delete\");\n\tfrappe.model.delete_doc(this.doctype, this.docname, function() {\n\t\twindow.history.back();\n\t});\n};\n\n_f.Frm.prototype.amend_doc = function() {\n\tif(!this.fields_dict['amended_from']) {\n\t\talert('\"amended_from\" field must be present to do an amendment.');\n\t\treturn;\n\t}\n\tthis.validate_form_action(\"Amend\");\n\tvar me = this;\n\tvar fn = function(newdoc) {\n\t\tnewdoc.amended_from = me.docname;\n\t\tif(me.fields_dict && me.fields_dict['amendment_date'])\n\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t};\n\tthis.copy_doc(fn, 1);\n\tfrappe.utils.play_sound(\"click\");\n};\n\n_f.Frm.prototype.disable_save = function() {\n\t// IMPORTANT: this function should be called in refresh event\n\tthis.save_disabled = true;\n\tthis.toolbar.current_status = null;\n\tthis.page.clear_primary_action();\n};\n\n_f.Frm.prototype.enable_save = function() {\n\tthis.save_disabled = false;\n\tthis.toolbar.set_primary_action();\n};\n\n_f.Frm.prototype.save_or_update = function() {\n\tif(this.save_disabled) return;\n\n\tif(this.doc.docstatus===0) {\n\t\tthis.save();\n\t} else if(this.doc.docstatus===1 && this.doc.__unsaved) {\n\t\tthis.save(\"Update\");\n\t}\n};\n\n_f.Frm.prototype.dirty = function() {\n\tthis.doc.__unsaved = 1;\n\tthis.$wrapper.trigger('dirty');\n};\n\n_f.Frm.prototype.get_docinfo = function() {\n\treturn frappe.model.docinfo[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.is_dirty = function() {\n\treturn this.doc.__unsaved;\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n\n_f.Frm.prototype.reload_docinfo = function(callback) {\n\tvar me = this;\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\targs: {\n\t\t\tdoctype: me.doctype,\n\t\t\tname: me.doc.name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// docinfo will be synced\n\t\t\tif(callback) callback(r.docinfo);\n\t\t\tme.timeline.refresh();\n\t\t\tme.assign_to.refresh();\n\t\t\tme.attachments.refresh();\n\t\t}\n\t});\n};\n\n\n_f.Frm.prototype.get_perm = function(permlevel, access_type) {\n\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n};\n\n\n_f.Frm.prototype.set_intro = function(txt, color) {\n\tthis.dashboard.set_headline_alert(txt, color);\n};\n\n_f.Frm.prototype.set_footnote = function(txt) {\n\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n};\n\n\n_f.Frm.prototype.add_custom_button = function(label, fn, group) {\n\t// temp! old parameter used to be icon\n\tif(group && group.indexOf(\"fa fa-\")!==-1) group = null;\n\tvar btn = this.page.add_inner_button(label, fn, group);\n\tif(btn) {\n\t\tthis.custom_buttons[label] = btn;\n\t}\n\treturn btn;\n};\n\n//Remove all custom buttons\n_f.Frm.prototype.clear_custom_buttons = function() {\n\tthis.page.clear_inner_toolbar();\n\tthis.page.clear_user_actions();\n\tthis.custom_buttons = {};\n};\n\n//Remove specific custom button by button Label\n_f.Frm.prototype.remove_custom_button = function(label, group) {\n\tthis.page.remove_inner_button(label, group);\n};\n\n_f.Frm.prototype.add_fetch = function(link_field, src_field, tar_field) {\n\tif(!this.fetch_dict[link_field]) {\n\t\tthis.fetch_dict[link_field] = {'columns':[], 'fields':[]};\n\t}\n\tthis.fetch_dict[link_field].columns.push(src_field);\n\tthis.fetch_dict[link_field].fields.push(tar_field);\n};\n\n_f.Frm.prototype.set_print_heading = function(txt) {\n\tthis.pformat[this.docname] = txt;\n};\n\n_f.Frm.prototype.action_perm_type_map = {\n\t\"Create\": \"create\",\n\t\"Save\": \"write\",\n\t\"Submit\": \"submit\",\n\t\"Update\": \"submit\",\n\t\"Cancel\": \"cancel\",\n\t\"Amend\": \"amend\",\n\t\"Delete\": \"delete\"\n};\n\n_f.Frm.prototype.validate_form_action = function(action, resolve) {\n\tvar perm_to_check = this.action_perm_type_map[action];\n\tvar allowed_for_workflow = false;\n\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t// workflows if the user already have those permissions. This is to allow for users to\n\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\tif ((frappe.workflow.is_read_only(this.doctype, this.docname) && (perms[\"write\"] ||\n\t\tperms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) || !frappe.workflow.is_read_only(this.doctype, this.docname)) {\n\t\tallowed_for_workflow = true;\n\t}\n\n\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\tif(resolve) {\n\t\t\t// re-enable buttons\n\t\t\tresolve();\n\t\t}\n\t\tfrappe.throw (__(\"No permission to '{0}' {1}\", [__(action), __(this.doc.doctype)]));\n\t}\n};\n\n_f.Frm.prototype.has_perm = function(ptype) {\n\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n};\n\n_f.Frm.prototype.scroll_to_element = function() {\n\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\tdelete frappe.route_options.scroll_to;\n\n\t\tvar selector = [];\n\t\tfor (var key in scroll_to) {\n\t\t\tvar value = scroll_to[key];\n\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', {key: key, value: value}));\n\t\t}\n\n\t\tselector = $(selector.join(\" \"));\n\t\tif (selector.length) {\n\t\t\tfrappe.utils.scroll_to(selector);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.show_success_action = function() {\n\tconst route = frappe.get_route();\n\tif (route[0] !== 'Form') return;\n\tif (this.meta.is_submittable && this.doc.docstatus !== 1) return;\n\n\tconst success_action = new frappe.ui.form.SuccessAction(this);\n\tsuccess_action.show();\n};\n\n_f.Frm.prototype.is_first_creation = function() {\n\tlet { modified, creation } = this.doc;\n\n\t// strip out milliseconds\n\tmodified = modified.split('.')[0];\n\tcreation = creation.split('.')[0];\n\n\treturn modified === creation;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n/* eslint-disable no-console */\n\nwindow.get_server_fields = function(method, arg, table_field, doc, dt, dn, allow_edit, call_back) {\n\tconsole.warn(\"This function 'get_server_fields' has been deprecated and will be removed soon.\");\n\tfrappe.dom.freeze();\n\tif($.isPlainObject(arg)) arg = JSON.stringify(arg);\n\treturn $c('runserverobj', {'method': method, 'docs': JSON.stringify(doc), 'arg': arg },\n\t\tfunction(r) {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tif (r.message)  {\n\t\t\t\tvar d = locals[dt][dn];\n\t\t\t\tvar field_dict = r.message;\n\t\t\t\tfor(var key in field_dict) {\n\t\t\t\t\td[key] = field_dict[key];\n\t\t\t\t\tif (table_field)\n\t\t\t\t\t\trefresh_field(key, d.name, table_field);\n\t\t\t\t\telse\n\t\t\t\t\t\trefresh_field(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(call_back){\n\t\t\t\tdoc = locals[doc.doctype][doc.name];\n\t\t\t\tcall_back(doc, dt, dn);\n\t\t\t}\n\t\t});\n};\n\n\nwindow.set_multiple = function(dt, dn, dict, table_field) {\n\tvar d = locals[dt][dn];\n\tfor(var key in dict) {\n\t\td[key] = dict[key];\n\t\tif (table_field)\n\t\t\trefresh_field(key, d.name, table_field);\n\t\telse\n\t\t\trefresh_field(key);\n\t}\n};\n\nwindow.refresh_many = function(flist, dn, table_field) {\n\tfor(var i in flist) {\n\t\tif (table_field)\n\t\t\trefresh_field(flist[i], dn, table_field);\n\t\telse\n\t\t\trefresh_field(flist[i]);\n\t}\n};\n\nwindow.set_field_tip = function(n,txt) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df)df.description = txt;\n\n\tif(cur_frm && cur_frm.fields_dict) {\n\t\tif(cur_frm.fields_dict[n])\n\t\t\tcur_frm.fields_dict[n].comment_area.innerHTML = frappe.utils.replace_newlines(txt);\n\t\telse\n\t\t\tconsole.log('[set_field_tip] Unable to set field tip: ' + n);\n\t}\n};\n\nwindow.refresh_field = function(n, docname, table_field) {\n\t// multiple\n\tif(typeof n==typeof [])\n\t\trefresh_many(n, docname, table_field);\n\n\tif (n && typeof n==='string' && table_field){\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, {fieldname: n});\n\t\tif (field && field.length){\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (docname){\n\t\t\t\tcur_frm.fields_dict[table_field].grid.grid_rows_by_docname[docname].refresh_field(n);\n\t\t\t} else {\n\t\t\t\tcur_frm.fields_dict[table_field].grid.refresh();\n\t\t\t}\n\t\t}\n\t} else if(cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function(n, txt) {\n\tcur_frm.set_df_property(n, 'options', txt);\n};\n\nwindow.set_field_permlevel = function(n, level) {\n\tcur_frm.set_df_property(n, 'permlevel', level);\n};\n\nwindow.toggle_field = function(n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n\nwindow.get_field_obj = function(fn) {\n\treturn cur_frm.fields_dict[fn];\n};\n\n_f.Frm.prototype.get_doc = function() {\n\treturn locals[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.set_currency_labels = function(fields_list, currency, parentfield) {\n\t// To set the currency in the label\n\t// For example Total Cost(INR), Total Cost(USD)\n\n\tvar me = this;\n\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\tvar field_label_map = {};\n\tvar grid_field_label_map = {};\n\n\t$.each(fields_list, function(i, fname) {\n\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\tif(docfield) {\n\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\tif(parentfield) {\n\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t} else {\n\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t}\n\t\t}\n\t});\n\n\t$.each(field_label_map, function(fname, label) {\n\t\tme.fields_dict[fname].set_label(label);\n\t});\n\n\t$.each(grid_field_label_map, function(fname, label) {\n\t\tfname = fname.split(\"-\");\n\t\tvar df = frappe.meta.get_docfield(fname[0], fname[1], me.doc.name);\n\t\tif(df) df.label = label;\n\t});\n};\n\n_f.Frm.prototype.field_map = function(fnames, fn) {\n\tif(typeof fnames==='string') {\n\t\tif(fnames == '*') {\n\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t} else {\n\t\t\tfnames = [fnames];\n\t\t}\n\t}\n\tfor (var i=0, l=fnames.length; i<l; i++) {\n\t\tvar fieldname = fnames[i];\n\t\tvar field = frappe.meta.get_docfield(cur_frm.doctype, fieldname, this.docname);\n\t\tif(field) {\n\t\t\tfn(field);\n\t\t\tthis.refresh_field(fieldname);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.get_docfield = function(fieldname1, fieldname2) {\n\tif(fieldname2) {\n\t\t// for child\n\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t} else {\n\t\t// for parent\n\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t}\n};\n\n_f.Frm.prototype.set_df_property = function(fieldname, property, value, docname, table_field) {\n\tvar df;\n\tif (!docname && !table_field){\n\t\tdf = this.get_docfield(fieldname);\n\t} else {\n\t\tvar grid = this.fields_dict[table_field].grid,\n\t\t\tfname = frappe.utils.filter_dict(grid.docfields, {'fieldname': fieldname});\n\t\tif (fname && fname.length)\n\t\t\tdf = frappe.meta.get_docfield(fname[0].parent, fieldname, docname);\n\t}\n\tif(df && df[property] != value) {\n\t\tdf[property] = value;\n\t\trefresh_field(fieldname, table_field);\n\t}\n};\n\n_f.Frm.prototype.toggle_enable = function(fnames, enable) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.read_only = enable ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.toggle_reqd = function(fnames, mandatory) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.reqd = mandatory ? true : false;\n\t});\n};\n\n_f.Frm.prototype.toggle_display = function(fnames, show) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.hidden = show ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.call_server = function(method, args, callback) {\n\treturn $c_obj(this.doc, method, args, callback);\n};\n\n_f.Frm.prototype.get_files = function() {\n\treturn this.attachments\n\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t: [] ;\n};\n\n_f.Frm.prototype.set_query = function(fieldname, opt1, opt2) {\n\tif(opt2) {\n\t\t// on child table\n\t\t// set_query(fieldname, parent fieldname, query)\n\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t} else {\n\t\t// on parent table\n\t\t// set_query(fieldname, query)\n\t\tif(this.fields_dict[fieldname]) {\n\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.set_value_if_missing = function(field, value) {\n\treturn this.set_value(field, value, true);\n};\n\n_f.Frm.prototype.clear_table = function(fieldname) {\n\tfrappe.model.clear_table(this.doc, fieldname);\n};\n\n_f.Frm.prototype.add_child = function(fieldname, values) {\n\tvar doc = frappe.model.add_child(this.doc, frappe.meta.get_docfield(this.doctype, fieldname).options, fieldname);\n\tif(values) {\n\t\t// Values of unique keys should not be overridden\n\t\tvar d = {};\n\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\tObject.keys(values).map((key) => {\n\t\t\tif(!unique_keys.includes(key)) {\n\t\t\t\td[key] = values[key];\n\t\t\t}\n\t\t});\n\n\t\t$.extend(doc, d);\n\t}\n\treturn doc;\n};\n\n_f.Frm.prototype.set_value = function(field, value, if_missing) {\n\tvar me = this;\n\tvar _set = function(f, v) {\n\t\tvar fieldobj = me.fields_dict[f];\n\t\tif(fieldobj) {\n\t\t\tif(!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\tif(frappe.model.table_fields.includes(fieldobj.df.fieldtype) && $.isArray(v)) {\n\n\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\tfor (var i=0, j=v.length; i < j; i++) {\n\t\t\t\t\t\tvar d = v[i];\n\t\t\t\t\t\tvar child = frappe.model.add_child(me.doc, fieldobj.df.options,\n\t\t\t\t\t\t\tfieldobj.df.fieldname, i+1);\n\t\t\t\t\t\t$.extend(child, d);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\treturn frappe.model.set_value(me.doctype, me.doc.name, f, v);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfrappe.msgprint(__(\"Field {0} not found.\",[f]));\n\t\t\tthrow \"frm.set_value\";\n\t\t}\n\t};\n\n\tif(typeof field==\"string\") {\n\t\treturn _set(field, value);\n\t} else if($.isPlainObject(field)) {\n\t\tlet tasks = [];\n\t\tfor (let f in field) {\n\t\t\tlet v = field[f];\n\t\t\tif(me.get_field(f)) {\n\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t}\n\t\t}\n\t\treturn frappe.run_serially(tasks);\n\t}\n};\n\n_f.Frm.prototype.call = function(opts, args, callback) {\n\tvar me = this;\n\tif(typeof opts==='string') {\n\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\topts = {\n\t\t\tmethod: opts,\n\t\t\tdoc: this.doc,\n\t\t\targs: args,\n\t\t\tcallback: callback\n\t\t};\n\t}\n\tif(!opts.doc) {\n\t\tif(opts.method.indexOf(\".\")===-1)\n\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif($.isPlainObject(r.message)) {\n\t\t\t\tif(opts.child) {\n\t\t\t\t\t// update child doc\n\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\tvar std_field_list = [\"doctype\"].concat(frappe.model.std_fields_list);\n\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\tif (std_field_list.indexOf(key)===-1) {\n\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t} else {\n\t\t\t\t\t// update parent doc\n\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\t} else {\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif(!r.exc) me.refresh_fields();\n\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\n\t}\n\treturn frappe.call(opts);\n};\n\n_f.Frm.prototype.get_field = function(field) {\n\treturn this.fields_dict[field];\n};\n\n\n_f.Frm.prototype.set_read_only = function() {\n\tvar perm = [];\n\tvar docperms = frappe.perm.get_perm(this.doc.doctype);\n\tfor (var i=0, l=docperms.length; i<l; i++) {\n\t\tvar p = docperms[i];\n\t\tperm[p.permlevel || 0] = {read:1, print:1, cancel:1};\n\t}\n\tthis.perm = perm;\n};\n\n_f.Frm.prototype.trigger = function(event) {\n\treturn this.script_manager.trigger(event);\n};\n\n_f.Frm.prototype.get_formatted = function(fieldname) {\n\treturn frappe.format(this.doc[fieldname],\n\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t{no_icon:true}, this.doc);\n};\n\n_f.Frm.prototype.open_grid_row = function() {\n\treturn frappe.ui.form.get_open_grid_form();\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n_f.Frm.prototype.get_title = function() {\n\tif(this.meta.title_field) {\n\t\treturn this.doc[this.meta.title_field];\n\t} else {\n\t\treturn this.doc.name;\n\t}\n};\n\n_f.Frm.prototype.get_selected = function() {\n\t// returns list of children that are selected. returns [parentfield, name] for each\n\tvar selected = {}, me = this;\n\tfrappe.meta.get_table_fields(this.doctype).forEach(function(df) {\n\t\t// handle TableMultiselect child fields\n\t\tlet _selected = [];\n\n\t\tif(me.fields_dict[df.fieldname].grid) {\n\t\t\t_selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\t}\n\n\t\tif(_selected.length) {\n\t\t\tselected[df.fieldname] = _selected;\n\t\t}\n\t});\n\treturn selected;\n};\n\n_f.Frm.prototype.has_mapper = function() {\n\t// hackalert!\n\t// if open_mapped_doc is mentioned in the custom script, then mapper exists\n\tif(this._has_mapper === undefined) {\n\t\tthis._has_mapper = (this.meta.__js && this.meta.__js.search('open_mapped_doc')!==-1) ?\n\t\t\ttrue: false;\n\t}\n\treturn this._has_mapper;\n};\n\n_f.Frm.prototype.set_indicator_formatter = function(fieldname, get_color, get_text) {\n\t// get doctype from parent\n\tvar doctype;\n\tif(frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\tdoctype = this.doctype;\n\t} else {\n\t\tfrappe.meta.get_table_fields(this.doctype).every(function(df) {\n\t\t\tif(frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\tdoctype = df.options;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfrappe.meta.docfield_map[doctype][fieldname].formatter =\n\t\tfunction(value, df, options, doc) {\n\t\t\tif(value) {\n\t\t\t\tvar label;\n\t\t\t\tif(get_text) {\n\t\t\t\t\tlabel = get_text(doc);\n\t\t\t\t} else if(frappe.form.link_formatters[df.options]) {\n\t\t\t\t\tlabel = frappe.form.link_formatters[df.options](value, doc);\n\t\t\t\t} else {\n\t\t\t\t\tlabel = value;\n\t\t\t\t}\n\n\t\t\t\tconst escaped_name = encodeURIComponent(value);\n\n\t\t\t\treturn repl('<a class=\"indicator %(color)s\" href=\"#Form/%(doctype)s/%(name)s\">%(label)s</a>', {\n\t\t\t\t\tcolor: get_color(doc || {}),\n\t\t\t\t\tdoctype: df.options,\n\t\t\t\t\tname: escaped_name,\n\t\t\t\t\tlabel: label\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t};\n};\n\n_f.Frm.prototype.can_create = function(doctype) {\n\t// return true or false if the user can make a particlar doctype\n\t// will check permission, `can_make_methods` if exists, or will decided on\n\t// basis of whether the document is submittable\n\tif(!frappe.model.can_create(doctype)) {\n\t\treturn false;\n\t}\n\n\tif(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t// custom buttons are translated and so are the keys\n\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t// if the button is present, then show make\n\t\treturn !!this.custom_buttons[key];\n\t}\n\n\tif(this.can_make_methods && this.can_make_methods[doctype]) {\n\t\treturn this.can_make_methods[doctype](this);\n\t} else {\n\t\tif(this.meta.is_submittable && !this.doc.docstatus==1) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.make_new = function(doctype) {\n\t// make new doctype from the current form\n\t// will handover to `make_methods` if defined\n\t// or will create and match link fields\n\tvar me = this;\n\tif(this.make_methods && this.make_methods[doctype]) {\n\t\treturn this.make_methods[doctype](this);\n\t} else if(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger('click');\n\t} else {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\n\t\t\t// set link fields (if found)\n\t\t\tfrappe.get_meta(doctype).fields.forEach(function(df) {\n\t\t\t\tif(df.fieldtype==='Link' && df.options===me.doctype) {\n\t\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.update_in_all_rows = function(table_fieldname, fieldname, value) {\n\t// update the child value in all tables where it is missing\n\tif(!value) return;\n\tvar cl = this.doc[table_fieldname] || [];\n\tfor(var i = 0; i < cl.length; i++){\n\t\tif(!cl[i][fieldname]) cl[i][fieldname] = value;\n\t}\n\trefresh_field(\"items\");\n};\n\n_f.Frm.prototype.get_sum = function(table_fieldname, fieldname) {\n\tlet sum = 0;\n\tfor (let d of (this.doc[table_fieldname] || [])) {\n\t\tsum += d[fieldname];\n\t}\n\treturn sum;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Toolbar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t},\n\trefresh: function() {\n\t\tthis.make_menu();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif(this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif(this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t},\n\tset_title: function() {\n\t\tif(this.frm.meta.title_field) {\n\t\t\tvar title = strip_html((this.frm.doc[this.frm.meta.title_field] || \"\").trim() || this.frm.docname);\n\t\t\tif(this.frm.doc.__islocal || title === this.frm.docname || this.frm.meta.autoname===\"hash\") {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t}\n\t\t} else {\n\t\t\tvar title = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif(this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename()));\n\n\t\tthis.set_indicator();\n\t},\n\tis_title_editable: function() {\n\t\tif (this.frm.meta.title_field===\"title\"\n\t\t\t&& this.frm.perm[0].write\n\t\t\t&& !this.frm.get_docfield(\"title\").options\n\t\t\t&& !this.frm.doc.__islocal) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\tcan_rename: function() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t},\n\tsetup_editable_title: function() {\n\t\tvar me = this;\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", function() {\n\t\t\tif(me.is_title_editable()) {\n\t\t\t\tfrappe.prompt({fieldname: \"title\", fieldtype:\"Data\",\n\t\t\t\t\tlabel: __(\"Title\"), reqd: 1, \"default\": me.frm.doc.title },\n\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\tif(data.title) {\n\t\t\t\t\t\t\tme.frm.set_value(\"title\", data.title);\n\t\t\t\t\t\t\tif(!me.frm.doc.__islocal) {\n\t\t\t\t\t\t\t\tme.frm.save_or_update();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.set_title();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, __(\"Edit Title\"), __(\"Update\"));\n\t\t\t}\n\t\t\tif(me.can_rename()) {\n\t\t\t\tme.frm.rename_doc();\n\t\t\t}\n\t\t});\n\t},\n\tget_dropdown_menu: function(label) {\n\t\treturn this.page.add_dropdown(label);\n\t},\n\tset_indicator: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif(indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t},\n\tmake_menu: function() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\t\tvar me = this;\n\t\tvar p = this.frm.perm[0];\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar is_submittable = frappe.model.is_submittable(this.frm.doc.doctype)\n\t\tvar issingle = this.frm.meta.issingle;\n\t\tvar print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\tvar allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tvar allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\t// Print\n\t\tif(!is_submittable || docstatus == 1  ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2)||\n\t\t\t(allow_print_for_draft && docstatus == 0)) {\n\t\t\tif(frappe.model.can_print(null, me.frm) && !issingle) {\n\t\t\t\tthis.page.add_menu_item(__(\"Print\"), function() {\n\t\t\t\t\tme.frm.print_doc();}, true);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\"fa fa-print\", function() {\n\t\t\t\t\tme.frm.print_doc();});\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif(frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(__(\"Email\"), function() {\n\t\t\t\tme.frm.email_doc();}, true);\n\t\t}\n\n\t\t// Linked With\n\t\tif(!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Links'), function() {\n\t\t\t\tme.show_linked_with();\n\t\t\t}, true)\n\t\t}\n\n\t\t// copy\n\t\tif(in_list(frappe.boot.user.can_create, me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(__(\"Duplicate\"), function() {\n\t\t\t\tme.frm.copy_doc();}, true);\n\t\t}\n\n\t\t// rename\n\t\tif(this.can_rename()) {\n\t\t\tthis.page.add_menu_item(__(\"Rename\"), function() {\n\t\t\t\tme.frm.rename_doc();}, true);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(__(\"Reload\"), function() {\n\t\t\tme.frm.reload_doc();}, true);\n\n\t\t// delete\n\t\tif((cint(me.frm.doc.docstatus) != 1) && !me.frm.doc.__islocal\n\t\t\t&& frappe.model.can_delete(me.frm.doctype)) {\n\t\t\tthis.page.add_menu_item(__(\"Delete\"), function() {\n\t\t\t\tme.frm.savetrash();}, true);\n\t\t}\n\n\t\tif(frappe.user_roles.includes(\"System Manager\") && me.frm.meta.issingle === 0) {\n\t\t\tthis.page.add_menu_item(__(\"Customize\"), function() {\n\t\t\t\tfrappe.set_route(\"Form\", \"Customize Form\", {\n\t\t\t\t\tdoc_type: me.frm.doctype\n\t\t\t\t})\n\t\t\t}, true);\n\n\t\t\tif (frappe.boot.developer_mode===1 && me.frm.meta.issingle) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(__(\"Edit DocType\"), function() {\n\t\t\t\t\tfrappe.set_route('Form', 'DocType', me.frm.doctype);\n\t\t\t\t}, true);\n\t\t\t}\n\t\t}\n\n\t\t// New\n\t\tif(p[CREATE] && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__(\"New {0} (Ctrl+B)\", [__(me.frm.doctype)]), function() {\n\t\t\t\tfrappe.new_doc(me.frm.doctype, true);}, true);\n\t\t}\n\t},\n\tcan_save: function() {\n\t\treturn this.get_docstatus()===0;\n\t},\n\tcan_submit: function() {\n\t\treturn this.get_docstatus()===0\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& !this.frm.doc.__unsaved\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& !this.has_workflow();\n\t},\n\tcan_update: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& this.frm.doc.__unsaved\n\t},\n\tcan_cancel: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& this.frm.perm[0].cancel\n\t\t\t&& !this.read_only;\n\t},\n\tcan_amend: function() {\n\t\treturn this.get_docstatus()===2\n\t\t\t&& this.frm.perm[0].amend\n\t\t\t&& !this.read_only;\n\t},\n\thas_workflow: function() {\n\t\tif(this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {document_type: this.frm.doctype}).length;\n\t\treturn this._has_workflow;\n\t},\n\tget_docstatus: function() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t},\n\tshow_linked_with: function() {\n\t\tif(!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t},\n\tset_primary_action: function(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\tif (status !== this.current_status) {\n\t\t\t\tthis.set_page_actions(status);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null\n\t\t}\n\t},\n\tget_action_status: function() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name==='print' || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t},\n\tset_page_actions: function(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif(status!== 'Edit') {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif(!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(__(\"Edit\"), function() {\n\t\t\t\tme.frm.page.set_view('main');\n\t\t\t}, 'octicon octicon-pencil');\n\t\t} else if(status === \"Cancel\") {\n\t\t\tthis.page.set_secondary_action(__(status), function() {\n\t\t\t\tme.frm.savecancel(this);\n\t\t\t}, \"octicon octicon-circle-slash\");\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\t\"Save\": function() {\n\t\t\t\t\treturn me.frm.save('Save', null, this);\n\t\t\t\t},\n\t\t\t\t\"Submit\": function() {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\t\"Update\": function() {\n\t\t\t\t\treturn me.frm.save('Update', null, this);\n\t\t\t\t},\n\t\t\t\t\"Amend\": function() {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t}\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\t\"Save\": \"octicon octicon-check\",\n\t\t\t\t\"Submit\": \"octicon octicon-lock\",\n\t\t\t\t\"Update\": \"octicon octicon-check\",\n\t\t\t\t\"Amend\": \"octicon octicon-split\"\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t},\n\tmake_cancel_amend_button: function() {\n\t\tvar me = this;\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar p = this.frm.perm[0];\n\t\tvar has_workflow = this.has_workflow();\n\n\t\tif(has_workflow) {\n\t\t\treturn;\n\t\t} else if(docstatus==1 && p[CANCEL]) {\n\t\t\tthis.page.set_secondary_action(__('Cancel'), function() {\n\t\t\t\tme.frm.savecancel(this) }, 'fa fa-ban-circle');\n\t\t} else if(docstatus==2 && p[AMEND]) {\n\t\t\tthis.page.set_secondary_action(__('Amend'), function() {\n\t\t\t\tme.frm.amend_doc() }, 'fa fa-pencil', true);\n\t\t}\n\t},\n\tadd_update_button_on_dirty: function() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function() {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif(!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t},\n\tshow_title_as_dirty: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tif(this.frm.doc.__unsaved) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.doc.__unsaved ? \"dirty\" : \"clean\");\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Dashboard = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.section = this.frm.fields_dict._form_dashboard.wrapper;\n\t\tthis.parent = this.section.find('.section-body');\n\t\tthis.wrapper = $(frappe.render_template('form_dashboard',\n\t\t\t{frm: this.frm})).appendTo(this.parent);\n\n\t\tthis.progress_area = this.wrapper.find(\".progress-area\");\n\t\tthis.heatmap_area = this.wrapper.find('.form-heatmap');\n\t\tthis.chart_area = this.wrapper.find('.form-graph');\n\t\tthis.stats_area = this.wrapper.find('.form-stats');\n\t\tthis.stats_area_row = this.stats_area.find('.row');\n\t\tthis.links_area = this.wrapper.find('.form-links');\n\t\tthis.transactions_area = this.links_area.find('.transactions');\n\n\t},\n\treset: function() {\n\t\tthis.section.addClass('hidden');\n\t\tthis.clear_headline();\n\n\t\t// clear progress\n\t\tthis.progress_area.empty().addClass('hidden');\n\n\t\t// clear links\n\t\tthis.links_area.addClass('hidden');\n\t\tthis.links_area.find('.count, .open-notification').addClass('hidden');\n\n\t\t// clear stats\n\t\tthis.stats_area.addClass('hidden')\n\t\tthis.stats_area_row.empty();\n\n\t\t// clear custom\n\t\tthis.wrapper.find('.custom').remove();\n\t},\n\tset_headline: function(html, color) {\n\t\tthis.frm.layout.show_message(html, color);\n\t},\n\tclear_headline: function() {\n\t\tthis.frm.layout.show_message();\n\t},\n\n\tadd_comment: function(text, alert_class, permanent) {\n\t\tvar me = this;\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif(!permanent) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tme.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t},\n\n\tclear_comment: function() {\n\t\tthis.clear_headline();\n\t},\n\n\tset_headline_alert: function(text, color) {\n\t\tif(text) {\n\t\t\tthis.set_headline(`<div>${text}</div>`, color);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t},\n\n\tadd_section: function(html) {\n\t\treturn $('<div class=\"form-dashboard-section custom\">'+html+'</div>').appendTo(this.wrapper);\n\t},\n\n\tadd_progress: function(title, percent, message) {\n\t\tvar progress_chart = this.make_progress_chart(title);\n\n\t\tif(!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tvar progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\t\t$.each(percent, function(i, opts) {\n\t\t\t$(repl('<div class=\"progress-bar %(progress_class)s\" style=\"width: %(width)s\" \\\n\t\t\t\ttitle=\"%(title)s\"></div>', opts)).appendTo(progress);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\t$(`<p class=\"progress-message text-muted small\">${message}</p>`).appendTo(progress_chart);\n\n\t\tthis.show();\n\n\t\treturn progress_chart;\n\t},\n\n\tshow_progress: function(title, percent, message) {\n\t\tthis._progress_map = this._progress_map || {};\n\t\tif (!this._progress_map[title]) {\n\t\t\tconst progress_chart = this.add_progress(title, percent, message);\n\t\t\tthis._progress_map[title] = progress_chart;\n\t\t}\n\t\tlet progress_chart = this._progress_map[title];\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\t\tprogress_chart.find('.progress-bar').each((i, progress_bar) => {\n\t\t\tconst { progress_class, width } = percent[i];\n\t\t\t$(progress_bar).css('width', width)\n\t\t\t\t.removeClass('progress-bar-danger progress-bar-success')\n\t\t\t\t.addClass(progress_class);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\tprogress_chart.find('.progress-message').text(message);\n\t},\n\n\thide_progress: function(title) {\n\t\tif (title){\n\t\t\tthis._progress_map[title].remove();\n\t\t\tdelete this._progress_map[title];\n\t\t} else {\n\t\t\tthis._progress_map = {};\n\t\t\tthis.progress_area.empty();\n\t\t}\n\t},\n\n\tformat_percent: function(title, percent) {\n\t\tvar width = cint(percent) < 1 ? 1 : cint(percent);\n\t\tvar progress_class = \"\";\n\t\tif(width < 10)\n\t\t\tprogress_class = \"progress-bar-danger\";\n\t\tif(width > 99.9)\n\t\t\tprogress_class = \"progress-bar-success\";\n\n\t\treturn [{\n\t\t\ttitle: title,\n\t\t\twidth: width + '%',\n\t\t\tprogress_class: progress_class\n\t\t}];\n\t},\n\tmake_progress_chart: function(title) {\n\t\tvar progress_chart = $('<div class=\"progress-chart\" title=\"'+(title || '')+'\"></div>')\n\t\t\t.appendTo(this.progress_area.removeClass('hidden'));\n\t\treturn progress_chart;\n\t},\n\n\trefresh: function() {\n\t\tthis.reset();\n\t\tif(this.frm.doc.__islocal) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tvar show = false;\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\tif(this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tthis.set_open_count();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(show) {\n\t\t\tthis.show();\n\t\t}\n\t},\n\n\tafter_refresh: function() {\n\t\tvar me = this;\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.find('.btn-new').each(function() {\n\t\t\tif(me.frm.can_create($(this).attr('data-doctype'))) {\n\t\t\t\t$(this).removeClass('hidden');\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_data: function() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif(!this.data.transactions) this.data.transactions = [];\n\t\tif(!this.data.internal_links) this.data.internal_links = {};\n\t\tthis.filter_permissions();\n\t},\n\n\tadd_transactions: function(opts) {\n\t\t// add additional data on dashboard\n\t\tlet group_added = [];\n\n\t\tif(!Array.isArray(opts)) opts=[opts];\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\t// check if label already exists, add items to it\n\t\t\tthis.data.transactions.map(group => {\n\t\t\t\topts.map(d => {\n\t\t\t\t\tif(d.label == group.label) {\n\t\t\t\t\t\tgroup_added.push(d.label);\n\t\t\t\t\t\tgroup.items.push(...d.items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if label not already present, add new label and items under it\n\t\t\topts.map(d => {\n\t\t\t\tif(!group_added.includes(d.label)) {\n\t\t\t\t\tthis.data.transactions.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.filter_permissions();\n\t\t}\n\t},\n\n\tfilter_permissions: function() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tvar transactions = [];\n\t\t(this.data.transactions || []).forEach(function(group) {\n\t\t\tvar items = [];\n\t\t\tgroup.items.forEach(function(doctype) {\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add thie group, if there is atleast\n\t\t\t// one item with permission\n\t\t\tif(items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t},\n\trender_links: function() {\n\t\tvar me = this;\n\t\tthis.links_area.removeClass('hidden');\n\t\tthis.links_area.find('.btn-new').addClass('hidden');\n\t\tif(this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\t//this.transactions_area.empty();\n\n\t\tthis.data.frm = this.frm;\n\n\t\t$(frappe.render_template('form_links', this.data))\n\t\t\t.appendTo(this.transactions_area)\n\n\t\t// bind links\n\t\tthis.transactions_area.find(\".badge-link\").on('click', function() {\n\t\t\tme.open_document_list($(this).parent());\n\t\t});\n\n\t\t// bind open notifications\n\t\tthis.transactions_area.find('.open-notification').on('click', function() {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\tthis.transactions_area.find('.btn-new').on('click', function() {\n\t\t\tme.frm.make_new($(this).attr('data-doctype'));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t},\n\topen_document_list: function($link, show_open) {\n\t\t// show document list with filters\n\t\tvar doctype = $link.attr('data-doctype'),\n\t\t\tnames = $link.attr('data-names') || [];\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names.length) {\n\t\t\t\tfrappe.route_options = {'name': ['in', names]};\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if(this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif(show_open) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype, \"List\");\n\t},\n\tget_document_filter: function(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tvar filter = {};\n\t\tvar fieldname = this.data.non_standard_fieldnames\n\t\t\t? (this.data.non_standard_fieldnames[doctype] || this.data.fieldname)\n\t\t\t: this.data.fieldname;\n\n\t\tif (this.data.dynamic_links && this.data.dynamic_links[fieldname]) {\n\t\t\tlet dynamic_fieldname = this.data.dynamic_links[fieldname][1];\n\t\t\tfilter[dynamic_fieldname] = this.data.dynamic_links[fieldname][0];\n\t\t}\n\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t},\n\tset_open_count: function() {\n\t\tif(!this.data.transactions || !this.data.fieldname) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tvar items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function(group) {\n\t\t\tgroup.items.forEach(function(item) { items.push(item); });\n\t\t});\n\n\t\tvar method = this.data.method || 'frappe.desk.notifications.get_open_count';\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name,\n\t\t\t\titems: items\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\t// update badges\n\t\t\t\t$.each(r.message.count, function(i, d) {\n\t\t\t\t\tme.frm.dashboard.set_badge_count(d.name, cint(d.open_count), cint(d.count));\n\t\t\t\t});\n\n\t\t\t\t// update from internal links\n\t\t\t\t$.each(me.data.internal_links, function(doctype, link) {\n\t\t\t\t\tvar table_fieldname = link[0], link_fieldname = link[1];\n\t\t\t\t\tvar names = [];\n\t\t\t\t\t(me.frm.doc[table_fieldname] || []).forEach(function(d) {\n\t\t\t\t\t\tvar value = d[link_fieldname];\n\t\t\t\t\t\tif(value && names.indexOf(value)===-1) {\n\t\t\t\t\t\t\tnames.push(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.frm.dashboard.set_badge_count(doctype, 0, names.length, names);\n\t\t\t\t});\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme.frm.trigger('dashboard_update');\n\t\t\t}\n\t\t});\n\n\t},\n\tset_badge_count: function(doctype, open_count, count, names) {\n\t\tvar $link = $(this.transactions_area)\n\t\t\t.find('.document-link[data-doctype=\"'+doctype+'\"]');\n\n\t\tif(open_count) {\n\t\t\t$link.find('.open-notification')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((open_count > 99) ? '99+' : open_count);\n\t\t}\n\n\t\tif(count) {\n\t\t\t$link.find('.count')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((count > 99) ? '99+' : count);\n\t\t}\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names && names.length) {\n\t\t\t\t$link.attr('data-names', names ? names.join(',') : '');\n\t\t\t} else {\n\t\t\t\t$link.find('a').attr('disabled', true);\n\t\t\t}\n\t\t}\n\t},\n\n\tupdate_heatmap: function(data) {\n\t\tif(this.heatmap) {\n\t\t\tthis.heatmap.update(data);\n\t\t}\n\t},\n\n\t// heatmap\n\trender_heatmap: function() {\n\t\tif(!this.heatmap) {\n\t\t\tthis.heatmap = new Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\t\ttype: 'heatmap',\n\t\t\t\theight: 120,\n\t\t\t\tstart: new Date(moment().subtract(1, 'year').toDate()),\n\t\t\t\tcount_label: \"interactions\",\n\t\t\t\tdiscreteDomains: 0,\n\t\t\t\tdata: {}\n\t\t\t});\n\n\t\t\t// center the heatmap\n\t\t\tthis.heatmap_area.removeClass('hidden').find('svg').css({'margin': 'auto'});\n\n\t\t\t// message\n\t\t\tvar heatmap_message = this.heatmap_area.find('.heatmap-message');\n\t\t\tif(this.data.heatmap_message) {\n\t\t\t\theatmap_message.removeClass('hidden').html(this.data.heatmap_message);\n\t\t\t} else {\n\t\t\t\theatmap_message.addClass('hidden');\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator: function(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.removeClass('hidden');\n\n\n\t\t// set colspan\n\t\tvar indicators = this.stats_area_row.find('.indicator-column');\n\t\tvar n_indicators = indicators.length + 1;\n\t\tvar colspan;\n\t\tif(n_indicators > 4) { colspan = 3 }\n\t\telse { colspan = 12 / n_indicators; }\n\n\t\t// reset classes in existing indicators\n\t\tif(indicators.length) {\n\t\t\tindicators.removeClass().addClass('col-sm-'+colspan).addClass('indicator-column');\n\t\t}\n\n\t\tvar indicator = $('<div class=\"col-sm-'+colspan+' indicator-column\"><span class=\"indicator '+color+'\">'\n\t\t\t+label+'</span></div>').appendTo(this.stats_area_row);\n\n\t\treturn indicator;\n\t},\n\n\t// graphs\n\tsetup_graph: function() {\n\t\tvar me = this;\n\t\tvar method = this.data.graph_method;\n\t\tvar args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\trender_graph: function(args) {\n\t\tvar me = this;\n\t\tthis.chart_area.empty().removeClass('hidden');\n\t\t$.extend(args, {\n\t\t\ttype: 'line',\n\t\t\tcolors: ['green']\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new Chart('.form-graph', args);\n\t\tif(!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t},\n\n\tshow: function() {\n\t\tthis.section.removeClass('hidden');\n\t},\n\n\thide: function() {\n\t\tthis.section.addClass('hidden');\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.document_flow');\n\nfrappe.ui.form.DocumentFlow = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.module = frappe.get_meta(this.frm.doctype).module\n\t\tif (!frappe.document_flow || !frappe.document_flow[this.module]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.doctypes = frappe.document_flow[this.module][this.frm.doctype];\n\t\tif (!this.doctypes) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"document-flow-wrapper hidden\"></div>').prependTo(this.frm.layout.wrapper);\n\t},\n\n\trefresh: function() {\n\t\tif(this.doctypes) {\n\t\t\tthis.reset();\n\t\t\tthis.render();\n\t\t}\n\t},\n\n\treset: function() {\n\t\tthis.wrapper.empty().addClass('hidden');\n\t\tthis.linked_with = {};\n\t},\n\n\trender: function() {\n\t\tvar me = this;\n\n\t\t$(frappe.render_template('form_document_flow', {\n\t\t\tfrm: this.frm,\n\t\t\tdoctypes: this.doctypes,\n\t\t})).appendTo(this.wrapper.removeClass('hidden'));\n\n\t\tthis.wrapper.on('click', '.document-flow-link', function() {\n\t\t\tvar doctype = $(this).attr(\"data-doctype\");\n\t\t\tif (me.frm.doctype != doctype) {\n\t\t\t\tme.get_linked_docs(doctype);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif (!this.frm.doc.__islocal) {\n\t\t\tthis.mark_completed_flow()\n\t\t}\n\n\t},\n\n\tget_linked_docs: function(for_doctype) {\n\t\tif(!this.linked_with[for_doctype]) {\n\t\t\tthis.linked_with[for_doctype] = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm,\n\t\t\t\tfor_doctype: for_doctype\n\t\t\t});\n\t\t}\n\n\t\tthis.linked_with[for_doctype].show();\n\t},\n\n\tmark_completed_flow: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.document_flow.get_document_completion_status\",\n\t\t\targs: {\n\t\t\t\tdoctypes: me.doctypes,\n\t\t\t\tfrm_doctype: me.frm.doctype,\n\t\t\t\tfrm_docname: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(!r.message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$.each(me.doctypes, function(i, doctype) {\n\t\t\t\t\tif (r.message[doctype] && me.frm.doctype!=doctype) {\n\t\t\t\t\t\tme.wrapper.find(\"[data-doctype='\"+doctype+\"']a .indicator\")\n\t\t\t\t\t\t\t.removeClass(\"darkgrey\")\n\t\t\t\t\t\t\t.addClass(\"black\")\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tvar working_label = {\n\t\t\"Save\": __(\"Saving\"),\n\t\t\"Submit\": __(\"Submitting\"),\n\t\t\"Update\": __(\"Updating\"),\n\t\t\"Amend\": __(\"Amending\"),\n\t\t\"Cancel\": __(\"Cancelling\")\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass('validated-form');\n\t\tif (check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message\n\t\t\t});\n\t\t} else {\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function() {\n\t\t/**\n\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\twhat users also consider to be an empty row\n\t\t */\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter(function(d){\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\ttables.map(\n\t\t\tfunction(doc){\n\t\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\t\tconst in_list_view_cells = cells.filter(function(df) {\n\t\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t\t});\n\n\t\t\t\tvar is_empty_row = function(cells) {\n\t\t\t\t\tfor (var i=0; i < cells.length; i++){\n\t\t\t\t\t\tif(locals[doc.doctype][doc.name][cells[i].fieldname]){\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname]\n\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar me = this;\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tvar df = frappe.meta.get_docfield(doc.doctype,\n\t\t\t\t\t\tdocfield.fieldname, frm.doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (df.reqd && !frappe.model.has_value(doc.doctype, doc.name, df.fieldname)) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tif (doc.parenttype) {\n\t\t\t\t\tvar message = __('Mandatory fields required in table {0}, Row {1}',\n\t\t\t\t\t\t[__(frappe.meta.docfield_map[doc.parenttype][doc.parentfield].label).bold(), doc.idx]);\n\t\t\t\t} else {\n\t\t\t\t\tvar message = __('Mandatory fields required in {0}', [__(doc.doctype)]);\n\n\t\t\t\t}\n\t\t\t\tmessage = message + '<br><br><ul><li>' + error_fields.join('</li><li>') + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\ttitle: __('Missing Fields')\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tvar scroll_to = function (fieldname) {\n\t\tvar f = cur_frm.fields_dict[fieldname];\n\t\tif (f) {\n\t\t\t$(document).scrollTop($(f.wrapper).offset().top - 60);\n\t\t}\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\")\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\tfrappe.ui.form.remove_old_form_route();\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.show_alert({message: __('Saved'), indicator: 'green'});\n\t\t\t\t}\n\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n}\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet index = -1;\n\tlet current_route = frappe.get_route();\n\tfrappe.route_history.map((arr, i) => {\n\t\tif (arr.join(\"/\") === current_route.join(\"/\")) {\n\t\t\tindex = i;\n\t\t}\n\t});\n\tfrappe.route_history.splice(index, 1);\n}\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (frappe._from_link && newdoc.doctype === frappe._from_link.df.options) {\n\t\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\t\t// set value\n\t\tif (doc && doc.parentfield) {\n\t\t\t//update values for child table\n\t\t\t$.each(frappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows, function (index, field) {\n\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t}\n\n\t\t// refresh field\n\t\tfrappe._from_link.refresh();\n\n\t\t// if from form, switch\n\t\tif (frappe._from_link.frm) {\n\t\t\tfrappe.set_route(\"Form\",\n\t\t\t\tfrappe._from_link.frm.doctype, frappe._from_link.frm.docname)\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t});\n\t\t}\n\n\t\tfrappe._from_link = null;\n\t}\n}\n\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nfrappe.ui.form.get_event_handler_list = function(doctype, fieldname) {\n\tif(!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif(!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n}\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function(doctype, fieldname, handler) {\n\tvar add_handler = function(fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\t\thandler_list.push(handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif(cur_frm && cur_frm.doctype===doctype) {\n\t\t\tcur_frm.events[fieldname] = handler;\n\t\t}\n\t}\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n}\n\n// remove standard event handlers\nfrappe.ui.form.off = function(doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif(handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif(cur_frm && cur_frm.doctype===doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif(cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n}\n\n\nfrappe.ui.form.trigger = function(doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n}\n\nfrappe.ui.form.ScriptManager = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tmake: function(ControllerClass) {\n\t\tthis.frm.cscript = $.extend(this.frm.cscript,\n\t\t\tnew ControllerClass({frm: this.frm}));\n\t},\n\ttrigger: function(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif(is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t},\n\thas_handlers: function(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t},\n\tget_handlers: function(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: []\n\t\t};\n\t\tif(frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function(i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif(this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif(this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t},\n\tsetup: function() {\n\t\tvar doctype = this.frm.meta;\n\t\tvar me = this;\n\n\t\t// js\n\t\tvar cs = doctype.__js;\n\t\tif(cs) {\n\t\t\tvar tmp = eval(cs);\n\t\t}\n\n\t\tif(doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\teval(doctype.__custom_js);\n\t\t\t} catch(e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error in Custom Script'),\n\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack  + '</code></pre>'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tif((['Data', 'Read Only', 'Text', 'Small Text', 'Currency',\n\t\t\t\t'Text Editor', 'Code', 'Link', 'Float', 'Int', 'Date'].includes(df.fieldtype) || df.read_only==1)\n\t\t\t\t&& df.fetch_from && df.fetch_from.indexOf(\".\")!=-1) {\n\t\t\t\tvar parts = df.fetch_from.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function(i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif(frappe.model.table_fields.includes(field.df.fieldtype)) {\n\t\t\t\t$.each(frappe.meta.get_docfields(field.df.options, me.frm.docname), function(i, df) {\n\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger('setup');\n\t},\n\tlog_error: function(caller, e) {\n\t\tfrappe.show_alert(\"Error in Client Script.\");\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t},\n\tcopy_from_first_row: function(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif(data.length===1 || data[0]===current_row) return;\n\n\t\tif(typeof fieldnames==='string') {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function(i, fieldname) {\n\t\t\tfrappe.model.set_value(current_row.doctype, current_row.name, fieldname,\n\t\t\t\tdata[0][fieldname]);\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif(!this.dialog)\n\t\t\tthis.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\thide_on_page_refresh: true,\n\t\t\ttitle: __(\"Linked With\")\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\t// execute ajax calls sequentially\n\t\t\t// 1. get linked doctypes\n\t\t\t// 2. load all doctypes\n\t\t\t// 3. load linked docs\n\t\t\tthis.get_linked_doctypes()\n\t\t\t\t.then(() => this.load_doctypes())\n\t\t\t\t.then(() => this.links_not_permitted_or_missing())\n\t\t\t\t.then(() => this.get_linked_docs())\n\t\t\t\t.then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tconst linked_docs = this.frm.__linked_docs;\n\n\t\tlet html = '';\n\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes.map(doctype => {\n\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map(doc => this.make_doc_row(doc, doctype)).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}).join('');\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tload_doctypes() {\n\t\tconst already_loaded = Object.keys(locals.DocType);\n\t\tlet doctypes_to_load = [];\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tdoctypes_to_load =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(doctype => !already_loaded.includes(doctype));\n\t\t}\n\n\t\t// load all doctypes asynchronously using with_doctype\n\t\tconst promises = doctypes_to_load.map(dt => {\n\t\t\treturn frappe.model.with_doctype(dt, () => {\n\t\t\t\tif(frappe.listview_settings[dt]) {\n\t\t\t\t\t// add additional fields to __linked_doctypes\n\t\t\t\t\tthis.frm.__linked_doctypes[dt].add_fields =\n\t\t\t\t\t\tfrappe.listview_settings[dt].add_fields;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tlinks_not_permitted_or_missing() {\n\t\tlet links = null;\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tlinks =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(frappe.model.can_get_report);\n\t\t}\n\n\t\tlet flag;\n\t\tif(!links) {\n\t\t\t$(this.dialog.body).html(`${this.frm.__linked_doctypes\n\t\t\t\t? __(\"Not enough permission to see links\")\n\t\t\t\t: __(\"Not Linked to any record\")}`);\n\t\t\tflag = true;\n\t\t}\n\t\tflag = false;\n\n\t\t// reject Promise if not_permitted or missing\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => flag ? reject() : resolve()\n\t\t);\n\t}\n\n\tget_linked_doctypes() {\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.frm.__linked_doctypes) {\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_doctypes\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tthis.frm.__linked_doctypes = r.message;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_linked_docs() {\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_docs\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tlinkinfo: this.frm.__linked_doctypes,\n\t\t\t\tfor_doctype: this.for_doctype\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tthis.frm.__linked_docs = r.message || {};\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"#Form/${doctype}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif(!this.state_fieldname)\n\t\t\treturn;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\n\tsetup_help: function() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(__(\"Help\"), function() {\n\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\tvar state = me.get_state();\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: \"Workflow: \"\n\t\t\t\t\t+ frappe.workflow.workflows[me.frm.doctype].name\n\t\t\t});\n\n\t\t\tfrappe.workflow.get_transitions(me.frm.doc).then((transitions) => {\n\t\t\t\tvar next_html = $.map(transitions,\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\treturn d.action.bold() + __(\" by Role \") + d.allowed;\n\t\t\t\t\t}).join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t\t$(d.body).html(\"<p>\"+__(\"Current status\")+\": \" + state.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Document is only editable by users of role\")+\": \"\n\t\t\t\t\t\t+ frappe.workflow.get_document_state(me.frm.doctype,\n\t\t\t\t\t\t\tstate).allow_edit.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Next actions\")+\": \"+ next_html +\"</p>\"\n\t\t\t\t\t+ (me.frm.doc.__islocal ? (\"<div class='alert alert-info'>\"\n\t\t\t\t\t\t+__(\"Workflow will start after saving.\")+\"</div>\") : \"\")\n\t\t\t\t\t+ \"<p class='help'>\"+__(\"Note: Other permission rules may also apply\")+\"</p>\"\n\t\t\t\t).css({padding: '15px'});\n\t\t\t\td.show();\n\t\t\t});\n\t\t}, true);\n\t},\n\n\trefresh: function() {\n\t\tconst me = this;\n\t\t// hide if its not yet saved\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tconst state = this.get_state();\n\n\t\tlet doctype = this.frm.doctype;\n\n\t\tif(state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t},\n\n\tshow_actions: function() {\n\t\tvar added = false;\n\t\tvar me = this;\n\n\t\tthis.frm.page.clear_actions_menu();\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved===1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction has_approval_access(transition) {\n\t\t\tlet approval_access = false;\n\t\t\tconst user = frappe.session.user;\n\t\t\tif (user === 'Administrator'\n\t\t\t\t|| transition.allow_self_approval\n\t\t\t\t|| user !== me.frm.doc.owner) {\n\t\t\t\tapproval_access = true;\n\t\t\t}\n\t\t\treturn approval_access;\n\t\t}\n\n\t\tfrappe.workflow.get_transitions(this.frm.doc).then(transitions => {\n\t\t\t$.each(transitions, function(i, d) {\n\t\t\t\tif(frappe.user_roles.includes(d.allowed) && has_approval_access(d)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tme.frm.page.add_action_item(__(d.action), function() {\n\t\t\t\t\t\tfrappe.xcall('frappe.model.workflow.apply_workflow',\n\t\t\t\t\t\t\t{doc: me.frm.doc, action: d.action})\n\t\t\t\t\t\t\t.then((doc) => {\n\t\t\t\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.setup_btn(added);\n\t\t});\n\n\t},\n\n\tsetup_btn: function(action_added) {\n\t\tif(action_added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.page.btn_secondary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t},\n\n\tset_default_state: function() {\n\t\tvar default_state = frappe.workflow.get_default_state(this.frm.doctype, this.frm.doc.docstatus);\n\t\tif(default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t},\n\n\tget_state: function() {\n\t\tif(!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t}\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.PrintPreview = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.bind_events();\n\t},\n\tmake: function () {\n\t\tthis.wrapper = this.frm.page.add_view(\"print\", frappe.render_template(\"print_layout\", {}));\n\n\t\t// only system manager can edit\n\t\tthis.wrapper.find(\".btn-print-edit\").toggle(frappe.user.has_role(\"System Manager\"));\n\t\tif (frappe.model.get_doc(\":Print Settings\", \"Print Settings\").enable_raw_printing == \"1\") {\n\t\t\tthis.wrapper.find(\".btn-printer-setting\").toggle(true);\n\t\t}\n\t},\n\tbind_events: function () {\n\t\tvar me = this;\n\t\tthis.wrapper.find(\".btn-print-close\").click(function () {\n\t\t\tme.frm.hide_print();\n\t\t});\n\n\t\t// hide print view on pressing escape, only if there is no focus on any input\n\t\t$(document).on(\"keydown\", function (e) {\n\t\t\tif (e.which === 27 && me.frm && e.target === document.body) {\n\t\t\t\tme.frm.hide_print();\n\t\t\t}\n\t\t});\n\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.meta.name);\n\t\tthis.print_letterhead = this.wrapper\n\t\t\t.find(\".print-letterhead\")\n\t\t\t.on(\"change\", function () { me.print_sel.trigger(\"change\"); })\n\t\t\t.prop(\"checked\", cint(\n\t\t\t\t(frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\t\t\t\t|| { with_letterhead: 1 }).with_letterhead) ? true : false);\n\t\tthis.print_sel = this.wrapper\n\t\t\t.find(\".print-preview-select\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.set_default_print_language();\n\t\t\t\tme.multilingual_preview();\n\t\t\t});\n\n\t\t//On selection of language get code and pass it to preview method\n\t\tthis.language_sel = this.wrapper\n\t\t\t.find(\".languages\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.lang_code = me.language_sel.val()\n\t\t\t\tme.multilingual_preview()\n\t\t\t});\n\n\t\tthis.wrapper.find(\".btn-printer-setting\").click(function () {\n\t\t\tme.printer_setting_dialog();\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-print\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.print_old_style();\n\t\t\t} else {\n\t\t\t\tme.printit();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-preview\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.new_page_preview_old_style();\n\t\t\t} else {\n\t\t\t\tme.new_page_preview();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-download-pdf\").click(function () {\n\t\t\tif (!me.is_old_style()) {\n\t\t\t\tvar w = window.open(\n\t\t\t\t\tfrappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t\t\t\t+ \"&format=\" + me.selected_format()\n\t\t\t\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\"))\n\t\t\t\t);\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-edit\").on(\"click\", function () {\n\t\t\tlet print_format = me.get_print_format();\n\t\t\tlet is_custom_format = print_format.name\n\t\t\t\t&& print_format.print_format_builder\n\t\t\t\t&& print_format.standard === 'No';\n\t\t\tlet is_standard_but_editable = print_format.name && print_format.custom_format;\n\n\t\t\tif (is_standard_but_editable) {\n\t\t\t\tfrappe.set_route(\"Form\", \"Print Format\", print_format.name);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (is_custom_format) {\n\t\t\t\tfrappe.set_route(\"print-format-builder\", print_format.name);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// start a new print format\n\t\t\tfrappe.prompt([\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"New Print Format Name\"),\n\t\t\t\t\tfieldname: \"print_format_name\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Based On'),\n\t\t\t\t\tfieldname: 'based_on',\n\t\t\t\t\tfieldtype: 'Read Only',\n\t\t\t\t\tdefault: print_format.name || 'Standard'\n\t\t\t\t}\n\t\t\t], (data) => {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tmake_new: true,\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: data.print_format_name,\n\t\t\t\t\tbased_on: data.based_on\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"print-format-builder\");\n\t\t\t}, __(\"New Custom Print Format\"), __(\"Start\"));\n\t\t});\n\n\t\t$(document).on('new-print-format', (e) => {\n\t\t\tthis.refresh_print_options();\n\t\t\tif (e.print_format) {\n\t\t\t\tthis.print_sel.val(e.print_format);\n\t\t\t}\n\t\t});\n\t},\n\tset_user_lang: function () {\n\t\tthis.lang_code = this.frm.doc.language;\n\t\t// Load all languages in the field\n\t\tthis.language_sel.empty()\n\t\t\t.add_options([{value:'', label:__(\"Select Language...\")}]\n\t\t\t\t.concat(frappe.get_languages()))\n\t\t\t.val(this.lang_code);\n\t\tthis.preview();\n\t},\n\tset_default_print_language: function () {\n \t\tvar print_format = this.get_print_format();\n\n \t\tif (print_format.default_print_language) {\n \t\t\tthis.lang_code = print_format.default_print_language;\n \t\t\tthis.language_sel.val(this.lang_code);\n \t\t} else {\n\t\t\tthis.language_sel.val(frappe.boot.lang);\n\t\t}\n \t},\n\tmultilingual_preview: function () {\n\t\tvar me = this;\n\t\tif (this.is_old_style()) {\n\t\t\tme.wrapper.find(\".btn-print-preview\").toggle(true);\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(false);\n\t\t\tme.set_style();\n\t\t\tme.preview_old_style();\n\t\t} else if (this.is_raw_printing()) {\n\t\t\tme.wrapper.find(\".btn-print-preview\").toggle(false);\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(false);\n\t\t\tme.preview();\n\t\t} else {\n\t\t\tme.wrapper.find(\".btn-print-preview\").toggle(true);\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(true);\n\t\t\tme.preview();\n\t\t}\n\t},\n\tpreview: function () {\n\t\tvar me = this;\n\t\tthis.get_print_html(function (out) {\n\t\t\tconst $print_format = me.wrapper.find(\".print-format\");\n\t\t\t$print_format.html(out.html);\n\t\t\tme.show_footer();\n\t\t\tme.set_style(out.style);\n\n\t\t\tconst print_height = $print_format.get(0).offsetHeight;\n\t\t\tconst $message = me.wrapper.find(\".page-break-message\");\n\n\t\t\tconst print_height_inches = frappe.dom.pixel_to_inches(print_height);\n\t\t\t// if contents are large enough, indicate that it will get printed on multiple pages\n\t\t\t// Maximum height for an A4 document is 11.69 inches\n\t\t\tif (print_height_inches > 11.69) {\n\t\t\t\t$message.text(__('This may get printed on multiple pages'));\n\t\t\t} else {\n\t\t\t\t$message.text('');\n\t\t\t}\n\t\t});\n\t},\n\tshow_footer: function() {\n\t\t// footer is hidden by default as reqd by pdf generation\n\t\t// simple hack to show it in print preview\n\t\tthis.wrapper.find('.print-format').css({\n\t\t\tdisplay: 'flex',\n\t\t\tflexDirection: 'column'\n\t\t});\n\t\tthis.wrapper.find('.page-break').css({\n\t\t\t'display': 'flex',\n\t\t\t'flex-direction': 'column',\n\t\t\t'flex': '1'\n\t\t});\n\t\tthis.wrapper.find('#footer-html').attr('style', `\n\t\t\tdisplay: block !important;\n\t\t\torder: 1;\n\t\t\tmargin-top: auto;\n\t\t`);\n\t},\n\tprintit: function () {\n\t\tlet print_server ;\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.printing.doctype.print_settings.print_settings.is_print_server_enabled\",\n\t\t\tcallback: function (data) {\n\t\t\t\tif (data.message) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\"method\": \"frappe.utils.print_format.print_by_server\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tprint_format:  me.selected_format(),\n\t\t\t\t\t\t\tno_letterhead: me.with_letterhead()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (me.get_mapped_printer().length === 1) {\n\t\t\t\t\t// printer is already mapped in localstorage (applies for both raw and pdf )\n\t\t\t\t\tif (me.is_raw_printing()) {\n\t\t\t\t\t\tme.get_raw_commands(function (out) {\n\t\t\t\t\t\t\tfrappe.ui.form.qz_connect().then(function () {\n\t\t\t\t\t\t\t\tlet printer_map = me.get_mapped_printer()[0];\n\t\t\t\t\t\t\t\tlet data = [out.raw_commands];\n\t\t\t\t\t\t\t\tlet config = qz.configs.create(printer_map.printer);\n\t\t\t\t\t\t\t\treturn qz.print(config, data);\n\t\t\t\t\t\t\t}).then(frappe.ui.form.qz_success).catch((err) => {\n\t\t\t\t\t\t\t\tfrappe.ui.form.qz_fail(err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __('PDF printing via \"Raw Print\" is not yet supported. Please remove the printer mapping in Printer Settings and try again.'),\n\t\t\t\t\t\t\tindicator: 'blue'\n\t\t\t\t\t\t}, 14);\n\t\t\t\t\t\t//Note: need to solve \"Error: Cannot parse (FILE)<URL> as a PDF file\" to enable qz pdf printing.\n\t\t\t\t\t}\n\t\t\t\t} else if (me.is_raw_printing()) {\n\t\t\t\t\t// printer not mapped in localstorage and the current print format is raw printing\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('Please set a printer mapping for this print format in the Printer Settings'),\n\t\t\t\t\t\tindicator: 'blue'\n\t\t\t\t\t}, 14);\n\t\t\t\t\tme.printer_setting_dialog();\n\t\t\t\t} else {\n\t\t\t\t\tme.new_page_preview(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tnew_page_preview: function (printit) {\n\t\tvar me = this;\n\t\tvar w = window.open(frappe.urllib.get_full_url(\"/printview?\"\n\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t+ (printit ? \"&trigger_print=1\" : \"\")\n\t\t\t+ \"&format=\" + me.selected_format()\n\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\")));\n\t\tif (!w) {\n\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t}\n\t},\n\tget_print_html: function (callback) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.www.printview.get_html_and_style\",\n\t\t\targs: {\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tprint_format: this.selected_format(),\n\t\t\t\tno_letterhead: !this.with_letterhead() ? 1 : 0,\n\t\t\t\t_lang: this.lang_code\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tcallback(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tget_raw_commands: function (callback) {\n\t\t// fetches rendered raw commands from the server for the current print format.\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.www.printview.get_rendered_raw_commands\",\n\t\t\targs: {\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tprint_format: this.selected_format(),\n\t\t\t\t_lang: this.lang_code\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tcallback(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tget_mapped_printer: function () {\n\t\t// returns a list of \"print format: printer\" mapping filtered by the current print format\n\t\tlet print_format_printer_map = this.get_print_format_printer_map();\n\t\tif (print_format_printer_map[this.frm.doctype]) {\n\t\t\treturn print_format_printer_map[this.frm.doctype].filter(\n\t\t\t\t(printer_map) => printer_map.print_format == this.selected_format());\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t},\n\tget_print_format_printer_map: function () {\n\t\t// returns the whole object \"print_format_printer_map\" stored in the localStorage.\n\t\ttry {\n\t\t\tlet print_format_printer_map = JSON.parse(localStorage.print_format_printer_map);\n\t\t\treturn print_format_printer_map;\n\t\t} catch (e) {\n\t\t\treturn {};\n\t\t}\n\t},\n\tpreview_old_style: function () {\n\t\tvar me = this;\n\t\tthis.with_old_style({\n\t\t\tformat: me.print_sel.val(),\n\t\t\tcallback: function (html) {\n\t\t\t\tme.wrapper.find(\".print-format\").html('<div class=\"alert alert-warning\">'\n\t\t\t\t\t+ __(\"Warning: This Print Format is in old style and cannot be generated via the API.\")\n\t\t\t\t\t+ '</div>'\n\t\t\t\t\t+ html);\n\t\t\t},\n\t\t\tno_letterhead: !this.with_letterhead(),\n\t\t\tonly_body: true,\n\t\t\tno_heading: true\n\t\t});\n\t},\n\trefresh_print_options: function () {\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.doctype);\n\t\treturn this.print_sel\n\t\t\t.empty().add_options(this.print_formats);\n\n\t},\n\twith_old_style: function (opts) {\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(opts.format, opts.callback, opts.no_letterhead, opts.only_body, opts.no_heading);\n\t\t});\n\t},\n\tprint_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.go,\n\t\t\t\t!me.with_letterhead());\n\t\t});\n\t},\n\tnew_page_preview_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.preview, !me.with_letterhead());\n\t\t});\n\t},\n\tselected_format: function () {\n\t\treturn this.print_sel.val() || this.frm.meta.default_print_format || \"Standard\";\n\t},\n\tis_old_style: function (format) {\n\t\treturn this.get_print_format(format).print_format_type === \"Client\";\n\t},\n\tis_raw_printing: function (format) {\n\t\treturn this.get_print_format(format).raw_printing === 1;\n\t},\n\tget_print_format: function (format) {\n\t\tif (!format) {\n\t\t\tformat = this.selected_format();\n\t\t}\n\n\t\tif (locals[\"Print Format\"] && locals[\"Print Format\"][format]) {\n\t\t\treturn locals[\"Print Format\"][format]\n\t\t} else {\n\t\t\treturn {}\n\t\t}\n\t},\n\twith_letterhead: function () {\n\t\treturn this.print_letterhead.is(\":checked\") ? 1 : 0;\n\t},\n\tset_style: function (style) {\n\t\tfrappe.dom.set_style(style || frappe.boot.print_css, \"print-style\");\n\t},\n\tprinter_setting_dialog: function () {\n\t\t// dialog for the Printer Settings\n\t\tvar me = this;\n\t\tthis.print_format_printer_map = me.get_print_format_printer_map();\n\t\tthis.data = [];\n\t\tthis.data = this.print_format_printer_map[this.frm.doctype] || [];\n\t\tthis.printer_list = [];\n\t\tfrappe.ui.form.qz_get_printer_list().then((data) => {\n\t\t\tthis.printer_list = data;\n\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Printer Settings\"),\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype: 'Section Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"printer_mapping\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: __('Printer Mapping'),\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\tdata: this.data,\n\t\t\t\t\tget_data: () => {\n\t\t\t\t\t\treturn this.data;\n\t\t\t\t\t},\n\t\t\t\t\tfields: [{\n\t\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\t\tfieldname: \"print_format\",\n\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\toptions: this.print_formats,\n\t\t\t\t\t\tread_only: 0,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __('Print Format')\n\t\t\t\t\t}, {\n\t\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\t\tfieldname: \"printer\",\n\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\toptions: this.printer_list,\n\t\t\t\t\t\tread_only: 0,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __('Printer')\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action: function () {\n\t\t\t\t\tlet printer_mapping = this.get_values()[\"printer_mapping\"];\n\t\t\t\t\tif (printer_mapping && printer_mapping.length) {\n\t\t\t\t\t\tlet print_format_list = printer_mapping.map(a => a.print_format);\n\t\t\t\t\t\tlet has_duplicate = print_format_list.some((item, idx) => print_format_list.indexOf(item) != idx);\n\t\t\t\t\t\tif (has_duplicate)\n\t\t\t\t\t\t\tfrappe.throw(__(\"Cannot have multiple printers mapped to a single print format.\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprinter_mapping = [];\n\t\t\t\t\t}\n\t\t\t\t\tthis.print_format_printer_map = me.get_print_format_printer_map();\n\t\t\t\t\tthis.print_format_printer_map[me.frm.doctype] = printer_mapping;\n\t\t\t\t\tlocalStorage.print_format_printer_map = JSON.stringify(this.print_format_printer_map);\n\t\t\t\t\tthis.hide();\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __('Save')\n\t\t\t});\n\t\t\tdialog.show();\n\t\t\tif (!(this.printer_list && this.printer_list.length)) {\n\t\t\t\tfrappe.throw(__(\"No Printer is Available.\"));\n\t\t\t}\n\t\t});\n\t}\n});\n\nfrappe.ui.get_print_settings = function (pdf, callback, letter_head) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head = locals[\":Company\"] && frappe.defaults.get_default('company')\n\t\t? locals[\":Company\"][frappe.defaults.get_default('company')][\"default_letter_head\"]\n\t\t: '';\n\n\tvar columns = [{\n\t\tfieldtype: \"Check\",\n\t\tfieldname: \"with_letter_head\",\n\t\tlabel: __(\"With Letter head\")\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"letter_head\",\n\t\tlabel: __(\"Letter Head\"),\n\t\tdepends_on: \"with_letter_head\",\n\t\toptions: $.map(frappe.boot.letter_heads, function (i, d) { return d }),\n\t\tdefault: letter_head || default_letter_head\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"orientation\",\n\t\tlabel: __(\"Orientation\"),\n\t\toptions: \"Landscape\\nPortrait\",\n\t\tdefault: \"Landscape\"\n\t}];\n\n\tfrappe.prompt(columns, function (data) {\n\t\tvar data = $.extend(print_settings, data);\n\t\tif (!data.with_letter_head) {\n\t\t\tdata.letter_head = null;\n\t\t}\n\t\tif (data.letter_head) {\n\t\t\tdata.letter_head = frappe.boot.letter_heads[print_settings.letter_head];\n\t\t}\n\t\tcallback(data);\n\t}, __(\"Print Settings\"));\n}\n\n\n// qz tray connection wrapper\n//  - allows active and inactive connections to resolve regardless\n//  - try to connect once before firing the mimetype launcher\n//  - if connection fails, catch the reject, fire the mimetype launcher\n//  - after mimetype launcher is fired, try to connect 3 more times\n//  - display success/fail message to user\nfrappe.ui.form.qz_connect = function () {\n\treturn new Promise(function (resolve, reject) {\n\t\tfrappe.ui.form.qz_init().then(() => {\n\t\t\tif (qz.websocket.isActive()) { // if already active, resolve immediately\n\t\t\t\t// frappe.show_alert({message: __('QZ Tray Connection Active!'), indicator: 'green'});\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t// try to connect once before firing the mimetype launcher\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __('Attempting Connection to QZ Tray...'),\n\t\t\t\t\tindicator: 'blue'\n\t\t\t\t});\n\t\t\t\tqz.websocket.connect().then(() => {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('Connected to QZ Tray!'),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\tresolve();\n\t\t\t\t}, function retry(err) {\n\t\t\t\t\tif (err.message === 'Unable to establish connection with QZ') {\n\t\t\t\t\t\t// if a connect was not successful, launch the mimetype, try 3 more times\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __('Attempting to launch QZ Tray...'),\n\t\t\t\t\t\t\tindicator: 'blue'\n\t\t\t\t\t\t}, 14);\n\t\t\t\t\t\twindow.location.assign(\"qz:launch\");\n\t\t\t\t\t\tqz.websocket.connect({\n\t\t\t\t\t\t\tretries: 3,\n\t\t\t\t\t\t\tdelay: 1\n\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Connected to QZ Tray!'),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tfrappe.throw(__('Error connecting to QZ Tray Application...<br><br> You need to have QZ Tray application installed and running, to use the Raw Print feature.<br><br><a target=\"_blank\" href=\"https://qz.io/download/\">Click here to Download and install QZ Tray</a>.<br> <a target=\"_blank\" href=\"https://erpnext.com/docs/user/manual/en/setting-up/print/raw-printing\">Click here to learn more about Raw Printing</a>.'));\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: 'QZ Tray ' + err.toString(),\n\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t}, 14);\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n}\n\nfrappe.ui.form.qz_init = function () {\n\t// Initializing qz tray library\n\treturn new Promise((resolve) => {\n\t\tif (typeof qz === \"object\" && typeof qz.version === \"string\") {\n\t\t\t// resolve immediately if already Initialized\n\t\t\tresolve();\n\t\t} else {\n\t\t\tlet qz_required_assets = [\n\t\t\t\t\"/assets/frappe/node_modules/js-sha256/build/sha256.min.js\",\n\t\t\t\t\"/assets/frappe/node_modules/qz-tray/qz-tray.js\"\n\t\t\t];\n\t\t\tfrappe.require(qz_required_assets,() => {\n\t\t\t\tqz.api.setPromiseType(function promise(resolver) {\n\t\t\t\t\treturn new Promise(resolver);\n\t\t\t\t});\n\t\t\t\tqz.api.setSha256Type(function (data) {\n\t\t\t\t\t// Codacy fix\n\t\t\t\t\t/*global sha256*/\n\t\t\t\t\treturn sha256(data);\n\t\t\t\t});\n\t\t\t\tresolve();\n\t\t\t});\n\t\t\t// note 'frappe.require' does not have callback on fail. Hence, any failure cannot be communicated to the user.\n\t\t}\n\n\t});\n}\n\nfrappe.ui.form.qz_get_printer_list = function () {\n\t// returns the list of printers that are available to the QZ Tray\n\treturn frappe.ui.form.qz_connect().then(function () {\n\t\treturn qz.printers.find();\n\t}).then((data) => {\n\t\treturn data;\n\t}).catch((err) => {\n\t\tfrappe.ui.form.qz_fail(err);\n\t});\n}\n\nfrappe.ui.form.qz_success = function () {\n\t// notify qz successful print\n\tfrappe.show_alert({\n\t\tmessage: __('Print Sent to the printer!'),\n\t\tindicator: 'green'\n\t});\n}\n\nfrappe.ui.form.qz_fail = function (e) {\n\t// notify qz errors\n\tfrappe.show_alert({\n\t\tmessage: __(\"QZ Tray Failed: \") + e.toString(),\n\t\tindicator: 'red'\n\t}, 20);\n}\n\n","frappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Sidebar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\n\tmake: function() {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {doctype: this.frm.doctype, frm:this.frm});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.comments = this.sidebar.find(\".sidebar-comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find('.sidebar-image-wrapper');\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_review();\n\t\tthis.make_shared();\n\t\tthis.make_viewers();\n\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\t\tthis.make_follow();\n\n\t\tthis.bind_events();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\n\t},\n\n\tbind_events: function() {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function() {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".form-comments\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function() {\n\t\t\tfrappe.ui.toggle_like(me.like_icon, me.frm.doctype, me.frm.doc.name, function() {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t});\n\t},\n\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t} else {\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\t\t\tthis.frm.follow.refresh();\n\t\t\tthis.frm.viewers.refresh();\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.doc._user_tags);\n\t\t\tthis.sidebar.find(\".modified-by\").html(__(\"{0} edited this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.modified_by) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.modified)]));\n\t\t\tthis.sidebar.find(\".created-by\").html(__(\"{0} created this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.owner) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.creation)]));\n\n\t\t\tthis.refresh_like();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t},\n\n\trefresh_comments: function() {\n\t\t$.map(this.frm.timeline.get_communications(), function(c) {\n\t\t\treturn (c.communication_type===\"Communication\" || (c.communication_type==\"Comment\" && c.comment_type===\"Comment\")) ? c : null;\n\t\t});\n\t\tthis.comments.find(\".n-comments\").html(this.frm.get_docinfo().total_comments);\n\t},\n\n\tmake_tags: function() {\n\t\tvar me = this;\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: this.sidebar.find(\".tag-area\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function(user_tags) {\n\t\t\t\tme.frm.doc._user_tags = user_tags;\n\t\t\t}\n\t\t});\n\t},\n\tmake_attachments: function() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm\n\t\t});\n\t},\n\tmake_assignments: function() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\tmake_shared: function() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\")\n\t\t});\n\t},\n\tmake_viewers: function() {\n\t\tthis.frm.viewers = new frappe.ui.form.Viewers({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-viewers\")\n\t\t});\n\t},\n\tadd_user_action: function(label, click) {\n\t\treturn $('<a>').html(label).appendTo($('<li class=\"user-action-row\">')\n\t\t\t.appendTo(this.user_actions.removeClass(\"hidden\"))).on(\"click\", click);\n\t},\n\tclear_user_actions: function() {\n\t\tthis.user_actions.addClass(\"hidden\")\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t},\n\n\tmake_like: function() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .octicon-heart\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .likes-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".liked-by-parent\"), \".liked-by\");\n\t},\n\tmake_follow: function(){\n\t\tthis.frm.follow = new frappe.ui.form.DocumentFollow({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".followed-by-section\")\n\t\t});\n\t},\n\trefresh_like: function() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\n\t\tthis.like_icon.toggleClass(\"text-extra-muted not-liked\",\n\t\t\t!frappe.ui.is_liked(this.frm.doc))\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t},\n\n\trefresh_image: function() {\n\t},\n\n\tmake_review: function() {\n\t\tif (frappe.boot.energy_points_enabled && !this.frm.is_new()) {\n\t\t\tthis.frm.reviews = new frappe.ui.form.Review({\n\t\t\t\tparent: this.sidebar.find(\".form-reviews\"),\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t}\n\t}\n});\n","frappe.ui.form.set_user_image = function(frm) {\n\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find('.title-image');\n\n\n\timage_section.toggleClass('hide', image_field ? false : true);\n\ttitle_image.toggleClass('hide', image_field ? false : true);\n\n\tif(!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = (window.cordova && image.indexOf('http')===-1) ?\n\t\t\tfrappe.base_url + image : image;\n\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.removeClass(\"hide\");\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.addClass('hide');\n\n\t\ttitle_image\n\t\t\t.css('background-color', '')\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.html('');\n\n\t} else {\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", null)\n\t\t\t.addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.removeClass('hide')\n\t\t\t.find('.standard-image')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", '')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t}\n\n}\n\nfrappe.ui.form.setup_user_image_event = function(frm) {\n\t// re-draw image on change of user image\n\tif(frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function(frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on('click', function() {\n\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\tif(!field.$input) {\n\t\t\tfield.make_input();\n\t\t}\n\t\tfield.$input.trigger('click');\n\t});\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Share = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\trefresh: function() {\n\t\tthis.render_sidebar();\n\t},\n\trender_sidebar: function() {\n\t\tvar me = this;\n\t\tthis.parent.empty();\n\n\t\tvar shared = this.shared || this.frm.get_docinfo().shared;\n\t\tshared = shared.filter(function(d) { return d });\n\t\tvar users = [];\n\t\tfor (var i=0, l=shared.length; i < l; i++) {\n\t\t\tvar s = shared[i];\n\n\t\t\tif (s.everyone) {\n\t\t\t\tusers.push({\n\t\t\t\t\ticon: \"octicon octicon-megaphone text-muted\",\n\t\t\t\t\tavatar_class: \"avatar-empty share-doc-btn shared-with-everyone\",\n\t\t\t\t\ttitle: __(\"Shared with everyone\")\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar user_info = frappe.user_info(s.user);\n\t\t\t\tusers.push({\n\t\t\t\t\timage: user_info.image,\n\t\t\t\t\tfullname: user_info.fullname,\n\t\t\t\t\tabbr: user_info.abbr,\n\t\t\t\t\tcolor: user_info.color,\n\t\t\t\t\ttitle: __(\"Shared with {0}\", [user_info.fullname])\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!me.frm.doc.__islocal) {\n\t\t\tusers.push({\n\t\t\t\ticon: \"octicon octicon-plus text-muted\",\n\t\t\t\tavatar_class: \"avatar-empty share-doc-btn\",\n\t\t\t\ttitle: __(\"Share\")\n\t\t\t});\n\t\t}\n\n\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\tthis.parent.find(\".avatar\").on(\"click\", function() {\n\t\t\tme.frm.share_doc();\n\t\t});\n\t},\n\tshow: function() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t}\n\t\t});\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + '</p>');\n\n\t\td.onhide = function() {\n\t\t\t// reload comments\n\t\t\tif(me.dirty) me.frm.reload_docinfo();\n\t\t}\n\n\t\td.show();\n\t},\n\trender_shared: function(shared) {\n\t\tif(shared)\n\t\t\tthis.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function(i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(frappe.render_template(\"set_sharing\", {frm: this.frm, shared: this.shared, everyone: everyone}))\n\t\t\t.appendTo(d.body);\n\n\t\tif(frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t},\n\tmake_user_input: function() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\t\"user_type\": \"System User\",\n\t\t\t\t\t\"name\": [\"!=\", frappe.session.user]\n\t\t\t\t}\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true\n\t\t});\n\n\t},\n\tadd_share_button: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".btn-add-share\").on(\"click\", function() {\n\t\t\tvar user = d.share_with.get_value();\n\t\t\tif(!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tnotify: $(d.body).find(\".add-share-notify\").prop(\"checked\") ? 1 : 0\n\t\t\t\t},\n\t\t\t\tbtn: this,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\tif(s && s.user===r.message.user) {\n\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_edit_share_events: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".edit-share\").on(\"click\", function() {\n\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tpermission_to: property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\teveryone: everyone\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tvar found = null;\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\tif(s && (s.user===user || (everyone && s.everyone===1))) {\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n});\n","// Copyright (c) 2019, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Review = class Review {\n\tconstructor({parent, frm}) {\n\t\tthis.parent = parent;\n\t\tthis.frm = frm;\n\t\tthis.points = frappe.boot.points;\n\t\tthis.make_review_container();\n\t\tthis.add_review_button();\n\t\tthis.update_reviewers();\n\t}\n\tupdate_points() {\n\t\treturn frappe.xcall('frappe.social.doctype.energy_point_log.energy_point_log.get_energy_points', {\n\t\t\tuser: frappe.session.user\n\t\t}).then(data => {\n\t\t\tfrappe.boot.points = data;\n\t\t\tthis.points = data;\n\t\t});\n\t}\n\tmake_review_container() {\n\t\tthis.review_list_wrapper = this.parent.find('.review-list');\n\t}\n\tadd_review_button() {\n\n\t\tthis.review_list_wrapper.append(`\n\t\t\t<span class=\"avatar avatar-small avatar-empty btn-add-review\" title=\"${__('Add Review')}\">\n\t\t\t\t<i class=\"octicon octicon-plus text-muted\"></i>\n\t\t\t</span>\n\t\t`);\n\n\t\tconst review_button = this.review_list_wrapper.find('.btn-add-review');\n\n\t\tif (!this.points.review_points) {\n\t\t\treview_button.click(false);\n\t\t\treview_button.popover({\n\t\t\t\ttrigger: 'hover',\n\t\t\t\tcontent: () => {\n\t\t\t\t\treturn `<div class=\"text-medium\">\n\t\t\t\t\t\t${__('You do not have enough review points')}\n\t\t\t\t\t</div>`;\n\t\t\t\t},\n\t\t\t\thtml: true\n\t\t\t});\n\t\t} else {\n\t\t\treview_button.click(() => this.show_review_dialog());\n\t\t}\n\t}\n\tget_involved_users() {\n\t\tconst user_fields = this.frm.meta.fields\n\t\t\t.filter(d => d.fieldtype === 'Link' && d.options === 'User')\n\t\t\t.map(d => d.fieldname);\n\n\t\tuser_fields.push('owner');\n\t\tlet involved_users = user_fields.map(field => this.frm.doc[field]);\n\n\t\tconst docinfo = this.frm.get_docinfo();\n\n\t\tinvolved_users = involved_users.concat(\n\t\t\tdocinfo.communications.map(d => d.sender && d.delivery_status==='sent'),\n\t\t\tdocinfo.comments.map(d => d.owner),\n\t\t\tdocinfo.versions.map(d => d.owner),\n\t\t\tdocinfo.assignments.map(d => d.owner)\n\t\t);\n\n\t\treturn involved_users\n\t\t\t.uniqBy(u => u)\n\t\t\t.filter(user => !['Administrator', frappe.session.user].includes(user))\n\t\t\t.filter(Boolean);\n\t}\n\tshow_review_dialog() {\n\t\tconst user_options = this.get_involved_users();\n\t\tconst doc_owner = this.frm.doc.owner;\n\t\tconst review_dialog = new frappe.ui.Dialog({\n\t\t\t'title': __('Add Review'),\n\t\t\t'fields': [{\n\t\t\t\tfieldname: 'to_user',\n\t\t\t\tfieldtype: 'Autocomplete',\n\t\t\t\tlabel: __('To User'),\n\t\t\t\toptions: user_options,\n\t\t\t\tdescription: __('Only users involved in the document are listed')\n\t\t\t}, {\n\t\t\t\tfieldname: 'review_type',\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tlabel: __('Action'),\n\t\t\t\toptions: [{\n\t\t\t\t\t'label': __('Appreciate'),\n\t\t\t\t\t'value': 'Appreciation'\n\t\t\t\t}, {\n\t\t\t\t\t'label': __('Criticize'),\n\t\t\t\t\t'value': 'Criticism'\n\t\t\t\t}],\n\t\t\t\tdefault: 'Appreciation'\n\t\t\t}, {\n\t\t\t\tfieldname: 'points',\n\t\t\t\tfieldtype: 'Int',\n\t\t\t\tlabel: __('Points'),\n\t\t\t\treqd: 1,\n\t\t\t\tdescription: __(`Currently you have ${this.points.review_points} review points`)\n\t\t\t}, {\n\t\t\t\tfieldtype: 'Small Text',\n\t\t\t\tfieldname: 'reason',\n\t\t\t\treqd: 1,\n\t\t\t\tlabel: __('Reason')\n\t\t\t}],\n\t\t\tprimary_action: (values) => {\n\t\t\t\treview_dialog.disable_primary_action();\n\t\t\t\tif (values.points > this.points.review_points) {\n\t\t\t\t\treturn frappe.msgprint(__('You do not have enough points'));\n\t\t\t\t}\n\t\t\t\tfrappe.xcall('frappe.social.doctype.energy_point_log.energy_point_log.review', {\n\t\t\t\t\tdoc: {\n\t\t\t\t\t\tdoctype: this.frm.doc.doctype,\n\t\t\t\t\t\tname: this.frm.doc.name,\n\t\t\t\t\t},\n\t\t\t\t\tto_user: values.to_user,\n\t\t\t\t\tpoints: values.points,\n\t\t\t\t\treview_type: values.review_type,\n\t\t\t\t\treason: values.reason\n\t\t\t\t}).then(review => {\n\t\t\t\t\treview_dialog.hide();\n\t\t\t\t\treview_dialog.clear();\n\t\t\t\t\tthis.frm.get_docinfo().energy_point_logs.unshift(review);\n\t\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t\t\tthis.update_reviewers();\n\t\t\t\t\tthis.update_points();\n\t\t\t\t}).finally(() => {\n\t\t\t\t\treview_dialog.enable_primary_action();\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Submit')\n\t\t});\n\t\treview_dialog.show();\n\t}\n\tupdate_reviewers() {\n\t\tconst review_logs = this.frm.get_docinfo().energy_point_logs\n\t\t\t.filter(log => ['Appreciation', 'Criticism'].includes(log.type));\n\n\t\tthis.review_list_wrapper.find('.review-pill').remove();\n\t\treview_logs.forEach(log => {\n\t\t\tlet review_pill = $(`\n\t\t\t\t<span class=\"review-pill\">\n\t\t\t\t\t${frappe.avatar(log.owner)}\n\t\t\t\t\t${frappe.energy_points.get_points(log.points)}\n\t\t\t\t</span>\n\t\t\t`);\n\t\t\tthis.review_list_wrapper.prepend(review_pill);\n\t\t\tthis.setup_detail_popover(review_pill, log);\n\t\t});\n\t}\n\tsetup_detail_popover(el, data) {\n\t\tlet subject = '';\n\t\tlet fullname = frappe.user.full_name(data.user);\n\t\tlet timestamp = `<span class=\"text-muted\">${frappe.datetime.comment_when(data.creation)}</span>`;\n\t\tlet message_parts = [Math.abs(data.points), fullname, timestamp];\n\t\tif (data.type === 'Appreciation') {\n\t\t\tif (data.points == 1) {\n\t\t\t\tsubject = __('{0} appreciation point for {1} {2}', message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __('{0} appreciation points for {1} {2}', message_parts);\n\t\t\t}\n\t\t} else {\n\t\t\tif (data.points == -1) {\n\t\t\t\tsubject = __('{0} criticism point for {1} {2}', message_parts);\n\t\t\t} else {\n\t\t\t\tsubject = __('{0} criticism points for {1} {2}', message_parts);\n\t\t\t}\n\t\t}\n\t\tel.popover({\n\t\t\tanimation: true,\n\t\t\ttrigger: 'hover',\n\t\t\tdelay: 500,\n\t\t\tplacement: 'top',\n\t\t\ttemplate:`\n\t\t\t\t<div class=\"review-popover popover\">\n\t\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t\t<div class=\"popover-content\"></div>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tcontent: () => {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"text-medium\">\n\t\t\t\t\t\t<div class=\"subject\">\n\t\t\t\t\t\t\t${subject}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"body\">\n\t\t\t\t\t\t\t<div>${data.reason}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: 'body'\n\t\t});\n\t\treturn el;\n\t}\n};\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Viewers = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tget_viewers: function() {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\tif (docinfo) {\n\t\t\treturn docinfo.viewers || {};\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t},\n\trefresh: function(data_updated) {\n\t\tthis.parent.empty();\n\n\t\tvar viewers = this.get_viewers();\n\n\t\tvar users = [];\n\t\tvar new_users = [];\n\t\tfor (var i=0, l=(viewers.current || []).length; i < l; i++) {\n\t\t\tvar username = viewers.current[i];\n\t\t\tif (username===frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tusers.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently viewing this document\", [user_info.fullname])\n\t\t\t});\n\n\t\t\tif (viewers.new.indexOf(username)!==-1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\t\t}\n\n\t\tif (users.length) {\n\t\t\tthis.parent.parent().removeClass(\"hidden\");\n\t\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\t} else {\n\t\t\tthis.parent.parent().addClass(\"hidden\");\n\t\t}\n\n\t\tif (data_updated && new_users.length) {\n\t\t\t// new user viewing this document, who wasn't viewing in the past\n\t\t\tif (new_users.length===1) {\n\t\t\t\tfrappe.show_alert(__(\"{0} is currently viewing this document\", [new_users[0]]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(__(\"{0} are currently viewing this document\", [frappe.utils.comma_and(new_users)]));\n\t\t\t}\n\n\t\t}\n\t}\n});\n\nfrappe.ui.form.set_viewers = function(data) {\n\tvar doctype = data.doctype;\n\tvar docname = data.docname;\n\tvar docinfo = frappe.model.get_docinfo(doctype, docname);\n\tvar past_viewers = ((docinfo && docinfo.viewers) || {}).past || [];\n\tvar viewers = data.viewers || [];\n\n\tvar new_viewers = viewers.filter(viewer => !past_viewers.includes(viewer));\n\n\tfrappe.model.set_docinfo(doctype, docname, \"viewers\", {\n\t\tpast: past_viewers.concat(new_viewers),\n\t\tnew: new_viewers,\n\t\tcurrent: viewers\n\t});\n\n\tif (cur_frm && cur_frm.doc && cur_frm.doc.doctype===doctype && cur_frm.doc.name==docname) {\n\t\tcur_frm.viewers.refresh(true);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Footer = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comments();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {}))\n\t\t\t.appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(function() {\n\t\t\tme.frm.save('Save', null, this);\n\t\t})\n\n\t},\n\tmake_comments: function() {\n\t\tthis.frm.timeline = new frappe.ui.form.Timeline({\n\t\t\tparent: this.wrapper.find(\".form-comments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Attachments = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment\").click(function() {\n\t\t\tme.new_attachment();\n\t\t});\n\t\tthis.add_attachment_wrapper = this.parent.find(\".add_attachment\").parent();\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t},\n\tmax_reached: function() {\n\t\t// no of attachments\n\t\tvar n = Object.keys(this.get_attachments()).length;\n\n\t\t// button if the number of attachments is less than max\n\t\tif(n < this.frm.meta.max_attachments || !this.frm.meta.max_attachments) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\trefresh: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.toggleClass(\"hide\", !max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tif(attachments.length) {\n\t\t\tattachments.forEach(function(attachment) {\n\t\t\t\tme.add_attachment(attachment)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t}\n\n\t},\n\tget_attachments: function() {\n\t\treturn this.frm.get_docinfo().attachments;\n\t},\n\tadd_attachment: function(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\n\t\tvar $attach = $(frappe.render_template(\"attachment\", {\n\t\t\t\"file_path\": \"/desk#Form/File/\" + fileid,\n\t\t\t\"icon\": attachment.is_private ? \"fa fa-lock\" : \"fa fa-unlock-alt\",\n\t\t\t\"file_name\": file_name,\n\t\t\t\"file_url\": frappe.urllib.get_full_url(file_url)\n\t\t})).insertAfter(this.attachments_label.addClass(\"has-attachments\"));\n\n\t\tvar $close =\n\t\t\t$attach.find(\".close\")\n\t\t\t.data(\"fileid\", fileid)\n\t\t\t.click(function() {\n\t\t\t\tvar remove_btn = this;\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tme.remove_attachment($(remove_btn).data(\"fileid\"))\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn false\n\t\t\t});\n\n\t\tif(!frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\t$close.remove();\n\t\t}\n\t},\n\tget_file_url: function(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf('files/') === 0) {\n\t\t\t\tfile_url = '/' + attachment.file_name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfile_url = '/files/' + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, '%23');\n\t},\n\tget_file_id_from_file_url: function(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function(i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t},\n\tremove_attachment_by_filename: function(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t},\n\tremove_attachment: function(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.remove_attach',\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tif(!r._server_messages)\n\t\t\t\t\t\tfrappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.reload_docinfo();\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t});\n\t},\n\tnew_attachment: function(fieldname) {\n\t\tvar me = this;\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\tnew frappe.ui.FileUploader({\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t\ton_success: (file_doc) => {\n\t\t\t\tthis.attachment_uploaded(file_doc);\n\t\t\t}\n\t\t});\n\t},\n\tget_args: function() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t}\n\t},\n\tattachment_uploaded:  function(attachment) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment);\n\t\tthis.frm.reload_docinfo();\n\n\t\tif(this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t},\n\tupdate_attachment: function(attachment) {\n\t\tif(attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t}\n\t},\n\tadd_to_attachments: function (attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor(var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif(form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t},\n\tremove_fileid: function(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function(i, attachment) {\n\t\t\tif(attachment.name!=fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.timeline');\nfrappe.separator_element = '<div>---</div>';\n\nfrappe.ui.form.Timeline = class Timeline {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"timeline\",\n\t\t\t{doctype: me.frm.doctype, allow_events_in_timeline: me.frm.meta.allow_events_in_timeline})).appendTo(me.parent);\n\n\t\tthis.list = this.wrapper.find(\".timeline-items\");\n\n\t\tthis.comment_area = frappe.ui.form.make_control({\n\t\t\tparent: this.wrapper.find('.timeline-head'),\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\ton_submit: (val) => {\n\t\t\t\tval && this.insert_comment(val, this.comment_area.button);\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_email_button();\n\t\tthis.setup_interaction_button();\n\n\t\tthis.list.on(\"click\", \".toggle-blockquote\", function() {\n\t\t\t$(this).parent().siblings(\"blockquote\").toggleClass(\"hidden\");\n\t\t});\n\n\t\tthis.setup_comment_like();\n\n\t\tthis.list.on(\"click\", \".btn-more\", function() {\n\t\t\tvar communications = me.get_communications();\n\t\t\tfrappe.call({\n\t\t\t\tbtn: this,\n\t\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tstart: communications.length\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tvar new_communications = r.message;\n\t\t\t\t\t\t\tvar communications = me.get_communications().concat(new_communications);\n\t\t\t\t\t\t\tfrappe.model.set_docinfo(me.frm.doc.doctype, me.frm.doc.name, \"communications\", communications);\n\n\t\t\t\t\t\t\tif (new_communications.length < 20) {\n\t\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t}\n\n\tsetup_email_button() {\n\t\tvar me = this;\n\t\tvar selector = this.frm.doctype === \"Communication\"? \".btn-reply-email\": \".btn-new-email\";\n\t\tthis.email_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tconst $btn = $(this);\n\t\t\t\tlet is_a_reply = true;\n\t\t\t\tif ($btn.is('.btn-new-email')) {\n\t\t\t\t\tis_a_reply = false;\n\t\t\t\t}\n\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient(),\n\t\t\t\t\tis_a_reply\n\t\t\t\t}\n\n\t\t\t\tif(me.frm.doctype === \"Communication\") {\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: \"\",\n\t\t\t\t\t\tlast_email: me.frm.doc,\n\t\t\t\t\t\trecipients: me.frm.doc.sender,\n\t\t\t\t\t\tsubject: __(\"Re: {0}\", [me.frm.doc.subject]),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst comment_value = frappe.markdown(me.comment_area.get_value());\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: strip_html(comment_value) ? comment_value : ''\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnew frappe.views.CommunicationComposer(args)\n\t\t\t});\n\t}\n\n\tsetup_interaction_button() {\n\t\tvar me = this;\n\t\tvar selector = \".btn-new-interaction\";\n\t\tthis.activity_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient()\n\t\t\t\t}\n\t\t\t\t$.extend(args, {\n\t\t\t\t\ttxt: frappe.markdown(me.comment_area.get_value())\n\t\t\t\t});\n\t\t\t\tnew frappe.views.InteractionComposer(args);\n\t\t\t});\n\t}\n\n\tsetup_editing_area() {\n\t\tthis.$editing_area = $('<div class=\"timeline-editing-area\">');\n\n\t\tthis.editing_area = new frappe.ui.CommentArea({\n\t\t\tparent: this.$editing_area,\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\tno_wrapper: true\n\t\t});\n\n\t\tthis.editing_area.destroy();\n\t}\n\n\trefresh(scroll_to_end) {\n\t\tvar me = this;\n\t\tthis.last_type = \"Comment\";\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.wrapper.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.wrapper.toggle(true);\n\t\tthis.list.empty();\n\t\tthis.comment_area.set_value('');\n\n\t\t// get all communications\n\t\tlet communications = this.get_communications(true);\n\n\t\t// append views\n\t\tvar views = this.get_view_logs();\n\t\tvar timeline = communications.concat(views);\n\n\t\t// append comments\n\t\ttimeline = timeline.concat(this.get_comments());\n\n\t\t// append energy point logs\n\t\ttimeline = timeline.concat(this.get_energy_point_logs());\n\n\t\t// append milestones\n\t\ttimeline = timeline.concat(this.get_milestones());\n\n\t\t// sort\n\t\ttimeline\n\t\t\t.filter(a => a.content)\n\t\t\t.sort((b, c) => me.compare_dates(b, c))\n\t\t\t.forEach(d => {\n\t\t\t\td.frm = me.frm;\n\t\t\t\tme.render_timeline_item(d);\n\t\t\t});\n\n\n\n\t\t// more btn\n\t\tif (this.more===undefined && timeline.length===20) {\n\t\t\tthis.more = true;\n\t\t}\n\n\t\tif (this.more) {\n\t\t\t$('<div class=\"timeline-item\">\\\n\t\t\t\t<button class=\"btn btn-default btn-xs btn-more\">More</button>\\\n\t\t\t</div>').appendTo(me.list);\n\t\t}\n\n\t\t// created\n\t\tme.render_timeline_item({\n\t\t\tcontent: __(\"created\"),\n\t\t\tcomment_type: \"Created\",\n\t\t\tcommunication_type: \"Comment\",\n\t\t\tsender: this.frm.doc.owner,\n\t\t\tcommunication_date: this.frm.doc.creation,\n\t\t\tcreation: this.frm.doc.creation,\n\t\t\tfrm: this.frm\n\t\t});\n\n\t\tthis.wrapper.find(\".is-email\").prop(\"checked\", this.last_type===\"Email\").change();\n\n\t\tthis.frm.sidebar.refresh_comments();\n\n\t\tthis.frm.trigger('timeline_refresh');\n\t}\n\n\tcompare_dates(b, c) {\n\t\tlet b_date = b.communication_date ? b.communication_date : b.creation;\n\t\tlet c_date = c.communication_date ? c.communication_date : c.creation;\n\t\tlet comparison = new Date(b_date) > new Date(c_date) ? -1 : 1;\n\t\treturn comparison;\n\t}\n\n\tmake_editing_area(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true\n\t\t});\n\t}\n\n\trender_timeline_item(c) {\n\t\tvar me = this;\n\t\tthis.prepare_timeline_item(c);\n\t\tvar $timeline_item = $(frappe.render_template(\"timeline_item\", {data:c, frm:this.frm}))\n\t\t\t.appendTo(me.list)\n\t\t\t.on(\"click\", \".delete-comment\", function() {\n\t\t\t\tvar name = $timeline_item.data('name');\n\t\t\t\tme.delete_comment(name);\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.on('click', '.edit-comment', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar name = $timeline_item.data('name');\n\n\t\t\t\tif($timeline_item.hasClass('is-editing')) {\n\t\t\t\t\tme.current_editing_area.submit();\n\t\t\t\t} else {\n\t\t\t\t\tconst $edit_btn = $(this);\n\t\t\t\t\tconst $timeline_content = $timeline_item.find('.timeline-item-content');\n\t\t\t\t\tconst $timeline_edit = $timeline_item.find('.timeline-item-edit');\n\t\t\t\t\tconst content = $timeline_content.html();\n\n\t\t\t\t\t// update state\n\t\t\t\t\t$edit_btn\n\t\t\t\t\t\t.text(__(\"Save\"))\n\t\t\t\t\t\t.find('i')\n\t\t\t\t\t\t.removeClass('octicon-pencil')\n\t\t\t\t\t\t.addClass('octicon-check');\n\t\t\t\t\t$timeline_content.hide();\n\t\t\t\t\t$timeline_item.addClass('is-editing');\n\n\t\t\t\t\t// initialize editing area\n\t\t\t\t\tme.current_editing_area = me.make_editing_area($timeline_edit);\n\t\t\t\t\tme.current_editing_area.set_value(content);\n\n\t\t\t\t\t// submit handler\n\t\t\t\t\tme.current_editing_area.on_submit = (value) => {\n\t\t\t\t\t\t$timeline_edit.empty();\n\t\t\t\t\t\t$timeline_content.show();\n\n\t\t\t\t\t\t// set content to new val so that on save and refresh the new content is shown\n\t\t\t\t\t\tc.content = value;\n\t\t\t\t\t\tfrappe.timeline.update_communication(c);\n\t\t\t\t\t\tme.update_comment(name, value);\n\t\t\t\t\t\t// all changes to the timeline_item for editing are reset after calling refresh\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\n\t\tif(c.communication_type==\"Communication\" && c.communication_medium===\"Email\") {\n\t\t\tthis.last_type = c.communication_medium;\n\t\t\tthis.add_reply_btn_event($timeline_item, c);\n\t\t}\n\n\t}\n\n\tadd_reply_btn_event($timeline_item, c) {\n\t\t$timeline_item.on('click', '.reply-link, .reply-link-all', (e) => {\n\t\t\tvar last_email = null;\n\n\t\t\tconst $target = $(e.currentTarget);\n\t\t\tconst name = $target.data().name;\n\n\t\t\t// find the email to reply to\n\t\t\tthis.get_communications().forEach(function(c) {\n\t\t\t\tif(c.name == name) {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst opts = {\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\ttxt: \"\",\n\t\t\t\ttitle: __('Reply'),\n\t\t\t\tfrm: this.frm,\n\t\t\t\tlast_email,\n\t\t\t\tis_a_reply: true\n\t\t\t};\n\n\t\t\tif ($target.is('.reply-link-all')) {\n\t\t\t\tif (last_email) {\n\t\t\t\t\topts.cc = last_email.cc;\n\t\t\t\t\topts.bcc = last_email.bcc;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// make the composer\n\t\t\tnew frappe.views.CommunicationComposer(opts);\n\t\t});\n\t}\n\n\tprepare_timeline_item(c) {\n\t\tif(!c.sender) c.sender = c.owner || 'Guest';\n\n\t\tif(c.sender && c.sender.indexOf(\"<\")!==-1) {\n\t\t\tc.sender = c.sender.split(\"<\")[1].split(\">\")[0];\n\t\t}\n\n\t\tc.user_info = frappe.user_info(c.sender);\n\n\t\tc[\"delete\"] = \"\";\n\t\tc[\"edit\"] = \"\";\n\t\tif(c.communication_type==\"Comment\" && (c.comment_type || \"Comment\") === \"Comment\") {\n\t\t\tif(frappe.model.can_delete(\"Comment\")) {\n\t\t\t\tc[\"delete\"] = '<a class=\"close delete-comment\" title=\"Delete\"  href=\"#\"><i class=\"octicon octicon-x\"></i></a>';\n\t\t\t}\n\n\t\t\tif(frappe.user.name == c.sender || (frappe.user.name == 'Administrator')) {\n\t\t\t\tc[\"edit\"] = '<a class=\"edit-comment text-muted\" title=\"Edit\" href=\"#\">Edit</a>';\n\t\t\t}\n\t\t}\n\t\tlet communication_date = c.communication_date || c.creation;\n\t\tc.comment_on_small = comment_when(communication_date, true);\n\t\tc.comment_on = comment_when(communication_date);\n\t\tc.futur_date = communication_date > frappe.datetime.now_datetime() ? true : false;\n\t\tif(!c.fullname) {\n\t\t\tc.fullname = c.sender_full_name || frappe.user.full_name(c.sender);\n\t\t}\n\n\t\tif(c.attachments && typeof c.attachments===\"string\")\n\t\t\tc.attachments = JSON.parse(c.attachments);\n\n\t\tif(c.communication_type==\"Comment\" && !c.comment_type) {\n\t\t\tc.comment_type = \"Comment\";\n\t\t}\n\n\t\tthis.set_icon_and_color(c);\n\n\t\t// label view\n\t\tif(c.comment_type===\"Workflow\" || c.comment_type===\"Label\") {\n\t\t\tc.comment_html = repl('<span class=\"label label-%(style)s\">%(text)s</span>', {\n\t\t\t\tstyle: frappe.utils.guess_style(c.content),\n\t\t\t\ttext: __(c.content)\n\t\t\t});\n\t\t} else {\n\t\t\tif(c.communication_type==\"Communication\" && c.communication_medium==\"Email\") {\n\t\t\t\tc.content = c.content.split(frappe.separator_element)[0];\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t} else if (c.communication_type===\"Feedback\") {\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t}\n\t\t\tif(!frappe.utils.is_html(c.content)) {\n\t\t\t\tc.content_html = frappe.markdown(__(c.content));\n\t\t\t} else {\n\t\t\t\tc.content_html = c.content;\n\t\t\t\tc.content_html = frappe.utils.strip_whitespace(c.content_html);\n\t\t\t}\n\n\t\t\t// bold @mentions\n\t\t\tif(c.comment_type===\"Comment\" &&\n\t\t\t\t// avoid adding <b> tag a 2nd time\n\t\t\t\t!c.content_html.match(/(^|\\W)<b>(@[^\\s]+)<\\/b>/)\n\t\t\t) {\n\t\t\t\t/*\n\t\t\t\t\tReplace the email ids by only displaying the string which\n\t\t\t\t\toccurs before the second `@` to enhance the mentions.\n\t\t\t\t\tEg.\n\t\t\t\t\t@abc@a-example.com will be converted to\n\t\t\t\t\t@abc with the below line of code.\n\t\t\t\t*/\n\n\t\t\t\tc.content_html = c.content_html.replace(/(<[a][^>]*>)/g, \"\");\n\t\t\t\t// bold the @mentions\n\t\t\t\tc.content_html = c.content_html.replace(/(@[^\\s@]*)@[^\\s@|<]*/g, \"<b>$1</b>\");\n\t\t\t}\n\n\t\t\tif (this.is_communication_or_comment(c)) {\n\t\t\t\tc.user_content = true;\n\t\t\t\tif (!$.isArray(c._liked_by)) {\n\t\t\t\t\tc._liked_by = JSON.parse(c._liked_by || \"[]\");\n\t\t\t\t}\n\n\t\t\t\tc.liked_by_user = c._liked_by.indexOf(frappe.session.user)!==-1;\n\t\t\t}\n\t\t}\n\n\t\t// basic level of XSS protection\n\t\tc.content_html = frappe.dom.remove_script_and_style(c.content_html);\n\n\t\t// subject\n\t\tc.show_subject = false;\n\t\tif(c.subject && c.communication_type===\"Communication\") {\n\t\t\tif(this.frm.doc.subject && !this.frm.doc.subject.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(this.frm.meta.title_field && this.frm.doc[this.frm.meta.title_field]\n\t\t\t\t&& !!this.frm.doc[this.frm.meta.title_field].includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(!this.frm.doc.name.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tis_communication_or_comment(c) {\n\t\treturn c.communication_type===\"Communication\"\n\t\t|| c.communication_type===\"Feedback\"\n\t\t|| (c.communication_type===\"Comment\" && (c.comment_type===\"Comment\"||c.comment_type===\"Relinked\"));\n\t}\n\n\tset_icon_and_color(c) {\n\t\tif(c.communication_type == \"Feedback\"){\n\t\t\tc.icon = \"octicon octicon-comment-discussion\"\n\t\t} else {\n\t\t\tc.icon = {\n\t\t\t\t\"Email\": \"octicon octicon-mail\",\n\t\t\t\t\"Chat\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Phone\": \"octicon octicon-device-mobile\",\n\t\t\t\t\"SMS\": \"octicon octicon-comment\",\n\t\t\t\t\"Event\": \"fa fa-calendar\",\n\t\t\t\t\"Meeting\": \"octicon octicon-briefcase\",\n\t\t\t\t\"ToDo\": \"fa fa-check\",\n\t\t\t\t\"Submitted\": \"octicon octicon-lock\",\n\t\t\t\t\"Cancelled\": \"octicon octicon-x\",\n\t\t\t\t\"Assigned\": \"octicon octicon-person\",\n\t\t\t\t\"Assignment Completed\": \"octicon octicon-check\",\n\t\t\t\t\"Comment\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Milestone\": \"octicon octicon-milestone\",\n\t\t\t\t\"Workflow\": \"octicon octicon-git-branch\",\n\t\t\t\t\"Label\": \"octicon octicon-tag\",\n\t\t\t\t\"Attachment\": \"octicon octicon-cloud-upload\",\n\t\t\t\t\"Attachment Removed\": \"octicon octicon-trashcan\",\n\t\t\t\t\"Shared\": \"octicon octicon-eye\",\n\t\t\t\t\"Unshared\": \"octicon octicon-circle-slash\",\n\t\t\t\t\"Like\": \"octicon octicon-heart\",\n\t\t\t\t\"Edit\": \"octicon octicon-pencil\",\n\t\t\t\t\"Relinked\": \"octicon octicon-check\",\n\t\t\t\t\"Reply\": \"octicon octicon-mail-reply\"\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t\tc.icon_fg = {\n\t\t\t\t\"Attachment Removed\": \"#333\",\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t}\n\t\tif(!c.icon_fg)\n\t\t\tc.icon_fg = \"#fff\";\n\t}\n\n\tget_communications(with_versions) {\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [].concat(docinfo.communications);\n\t\tif(with_versions) {\n\t\t\tthis.build_version_comments(docinfo, out);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tget_view_logs(){\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [];\n\t\tfor (let c of docinfo.views){\n\t\t\tc.content = `<a href=\"#Form/View Log/${c.name}\"> ${__(\"viewed\")}</a>`;\n\t\t\tc.comment_type = \"Info\";\n\t\t\tout.push(c);\n\t\t};\n\t\treturn out;\n\t}\n\n\tget_comments() {\n\t\tlet docinfo = this.frm.get_docinfo();\n\n\t\tfor (let c of docinfo.comments) {\n\t\t\tthis.cast_comment_as_communication(c);\n\t\t}\n\n\t\treturn docinfo.comments;\n\t}\n\n\tget_energy_point_logs() {\n\t\tlet energy_point_logs = this.frm.get_docinfo().energy_point_logs;\n\t\tenergy_point_logs.map(log => {\n\t\t\tlog.comment_type = 'Energy Points';\n\t\t\tlog.content = frappe.energy_points.format_form_log(log);\n\t\t\treturn log;\n\t\t});\n\t\treturn energy_point_logs;\n\t}\n\n\tget_milestones() {\n\t\tlet milestones = this.frm.get_docinfo().milestones;\n\t\tmilestones.map(log => {\n\t\t\tlog.color = 'dark';\n\t\t\tlog.sender = log.owner;\n\t\t\tlog.comment_type = 'Milestone';\n\t\t\tlog.content = __('{0} changed {1} to {2}', [\n\t\t\t\tfrappe.user.full_name(log.owner).bold(),\n\t\t\t\tfrappe.meta.get_label(this.frm.doctype, log.track_field),\n\t\t\t\tlog.value.bold()]);\n\t\t\treturn log;\n\t\t});\n\t\treturn milestones;\n\t}\n\n\tcast_comment_as_communication(c) {\n\t\tc.sender = c.comment_email;\n\t\tc.sender_full_name = c.comment_by;\n\t\tc.communication_type = 'Comment';\n\t}\n\n\tbuild_version_comments(docinfo, out) {\n\t\tvar me = this;\n\t\tdocinfo.versions.forEach(function(version) {\n\t\t\tif(!version.data) return;\n\t\t\tvar data = JSON.parse(version.data);\n\n\t\t\t// comment\n\t\t\tif(data.comment) {\n\t\t\t\tout.push(me.get_version_comment(version, data.comment, data.comment_type));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// value changed in parent\n\t\t\tif(data.changed && data.changed.length) {\n\t\t\t\tvar parts = [];\n\t\t\t\tdata.changed.every(function(p) {\n\t\t\t\t\tif(p[0]==='docstatus') {\n\t\t\t\t\t\tif(p[2]==1) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('submitted this document')));\n\t\t\t\t\t\t} else if (p[2]==2) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('cancelled this document')));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2}', [\n\t\t\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(frappe.utils.html2text(p[1]), 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(frappe.utils.html2text(p[2]), 40) || '\"\"').bold()\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed value of {0}\", [parts.join(', ').bold()])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// value changed in table field\n\t\t\tif(data.row_changed && data.row_changed.length) {\n\t\t\t\tvar parts = [], count = 0;\n\t\t\t\tdata.row_changed.every(function(row) {\n\t\t\t\t\trow[3].every(function(p) {\n\t\t\t\t\t\tvar df = me.frm.fields_dict[row[0]] &&\n\t\t\t\t\t\t\tfrappe.meta.get_docfield(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\tp[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df,\n\t\t\t\t\t\t\t\tnull, me.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2} in row #{3}', [\n\t\t\t\t\t\t\t\t\tfrappe.meta.get_label(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\t\t\tp[0]),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\trow[1]\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t\t});\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed values for {0}\",\n\t\t\t\t\t\t[parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// rows added / removed\n\t\t\t// __('added'), __('removed') # for translation, don't remove\n\t\t\t['added', 'removed'].forEach(function(key) {\n\t\t\t\tif(data[key] && data[key].length) {\n\t\t\t\t\tparts = (data[key] || []).map(function(p) {\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\treturn frappe.meta.get_label(me.frm.doctype, p[0])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tparts = parts.filter(function(p) { return p; });\n\t\t\t\t\tif(parts.length) {\n\t\t\t\t\t\tout.push(me.get_version_comment(version, __(\"{0} rows for {1}\",\n\t\t\t\t\t\t\t[__(key), parts.join(', ')])));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_version_comment(version, text, comment_type) {\n\t\tif(!comment_type) {\n\t\t\ttext = '<a href=\"#Form/Version/'+version.name+'\">' + text + '</a>';\n\t\t}\n\t\treturn {\n\t\t\tcomment_type: comment_type || 'Edit',\n\t\t\tcreation: version.creation,\n\t\t\towner: version.owner,\n\t\t\tversion_name: version.name,\n\t\t\tsender: version.owner,\n\t\t\tcomment_by: version.owner,\n\t\t\tcontent: text\n\t\t};\n\t}\n\n\tinsert_comment(comment, btn) {\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.utils.add_comment\",\n\t\t\targs: {\n\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\treference_name: this.frm.docname,\n\t\t\t\tcontent: comment,\n\t\t\t\tcomment_email: frappe.session.user\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tme.comment_area.set_value('');\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t\t\tfrappe.timeline.new_communication(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tdelete_comment(name) {\n\t\tvar me = this;\n\n\t\tfrappe.confirm(__('Delete comment?'), function() {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"frappe.client.delete\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Comment\",\n\t\t\t\t\tname: name\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\n\t\t\t\t\t\tme.frm.get_docinfo().communications =\n\t\t\t\t\t\t\t$.map(me.frm.get_docinfo().communications,\n\t\t\t\t\t\t\t\tfunction(v) {\n\t\t\t\t\t\t\t\t\tif(v.name==name) return null;\n\t\t\t\t\t\t\t\t\telse return v;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tme.refresh(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Update comment\n\t *\n\t * @param {string} name\n\t * @param {string} content\n\t *\n\t * @returns {boolean}\n\t */\n\tupdate_comment(name, content){\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.update_comment',\n\t\t\targs: { name, content },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound('click');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tget_last_email(from_recipient) {\n\t\tvar last_email = null,\n\t\t\tcommunications = this.frm.get_docinfo().communications,\n\t\t\temail = this.get_recipient();\n\n\t\t$.each(communications && communications.sort(function(a, b) { return a.creation > b.creation ? -1 : 1 }), function(i, c) {\n\t\t\tif(c.communication_type=='Communication' && c.communication_medium==\"Email\") {\n\t\t\t\tif(from_recipient) {\n\t\t\t\t\tif(c.sender.indexOf(email)!==-1) {\n\t\t\t\t\t\tlast_email = c;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn last_email;\n\t}\n\n\tget_names_for_mentions() {\n\t\tvar valid_users = Object.keys(frappe.boot.user_info)\n\t\t\t.filter(user => ![\"Administrator\", \"Guest\"].includes(user));\n\t\tvalid_users = valid_users\n\t\t\t.filter(user => frappe.boot.user_info[user].allowed_in_mentions==1);\n\t\treturn valid_users.map(user => frappe.boot.user_info[user].name);\n\t}\n\n\tsetup_comment_like() {\n\t\tthis.wrapper.on(\"click\", \".comment-likes .octicon-heart\", frappe.ui.click_toggle_like);\n\n\t\tfrappe.ui.setup_like_popover(this.wrapper, \".comment-likes\");\n\t}\n};\n\n$.extend(frappe.timeline, {\n\tnew_communication: function(communication) {\n\t\tif (!communication.communication_type) {\n\t\t\tcommunication.communication_type = 'Comment';\n\t\t}\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\t\t\tvar communication_exists = false;\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tcommunication_exists = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!communication_exists) {\n\t\t\t\tdocinfo.communications = communications.concat([communication]);\n\t\t\t}\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tdelete_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\t\tif (index !== -1) {\n\t\t\t// remove it from communications list\n\t\t\tdocinfo.communications.splice(index, 1);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tupdate_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\n\t\tif (index !== -1) {\n\t\t\t// update\n\t\t\t$.extend(docinfo.communications[index], communication);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tindex_of_communication: function(communication, docinfo) {\n\t\tvar index = -1;\n\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.AssignTo = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment\").on(\"click\", function() { me.add(); });\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t},\n\trender: function(d) {\n\t\tvar me = this;\n\t\tthis.frm.get_docinfo().assignments = d;\n\t\tthis.parent.find(\".assignment-row\").remove();\n\n\t\tif(me.primary_action) {\n\t\t\tme.primary_action.remove();\n\t\t\tme.primary_action = null;\n\t\t}\n\n\t\tif(this.dialog) {\n\t\t\tthis.dialog.hide();\n\t\t}\n\n\t\tif(d && d.length) {\n\t\t\tfor(var i=0; i<d.length; i++) {\n\t\t\t\tvar info = frappe.user_info(d[i].owner);\n\t\t\t\tinfo.assign_to_name = d[i].name\n\t\t\t\tinfo.owner = d[i].owner;\n\t\t\t\tinfo.avatar = frappe.avatar(d[i].owner);\n\t\t\t\tinfo.description = d[i].description || \"\";\n\n\t\t\t\tinfo._fullname = info.fullname;\n\t\t\t\tif(info.fullname.length > 10) {\n\t\t\t\t\tinfo._fullname = info.fullname.substr(0, 10) + '...';\n\t\t\t\t}\n\n\t\t\t\t$(repl('<li class=\"assignment-row\">\\\n\t\t\t\t\t<a class=\"close\" data-owner=\"%(owner)s\">&times;</a>\\\n\t\t\t\t\t%(avatar)s\\\n\t\t\t\t\t<span><a href=\"#Form/ToDo/%(assign_to_name)s\">%(_fullname)s</a></span>\\\n\t\t\t\t</li>', info))\n\t\t\t\t\t.insertBefore(this.parent.find('.add-assignment'));\n\n\t\t\t\tif(d[i].owner===frappe.session.user) {\n\t\t\t\t\tme.primary_action = this.frm.page.add_menu_item(__(\"Assignment Complete\"), function() {\n\t\t\t\t\t\tme.remove(frappe.session.user);\n\t\t\t\t\t}, \"fa fa-check\", \"btn-success\")\n\t\t\t\t}\n\n\t\t\t\tif(!(d[i].owner === frappe.session.user || me.frm.perm[0].write)) {\n\t\t\t\t\tme.parent.find('a.close').remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set remove\n\t\t\tthis.parent.find('a.close').click(function() {\n\t\t\t\tme.remove($(this).attr('data-owner'));\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t//this.btn_wrapper.addClass(\"hide\");\n\t\t} else {\n\t\t\t//this.btn_wrapper.removeClass(\"hide\");\n\t\t}\n\t},\n\tadd: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif(!me.assign_to) {\n\t\t\tme.assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: me,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add',\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.assign_to.dialog.clear();\n\n\t\tif(me.frm.meta.title_field) {\n\t\t\tme.assign_to.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field])\n\t\t}\n\n\t\tme.assign_to.dialog.show();\n\t\tme.assign_to = null;\n\t},\n\tremove: function(owner) {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.desk.form.assign_to.remove',\n\t\t\targs: {\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tname: me.frm.docname,\n\t\t\t\tassign_to: owner\n\t\t\t},\n\t\t\tcallback:function(r,rt) {\n\t\t\t\tme.render(r.message);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\nfrappe.ui.form.AssignToDialog = Class.extend({\n\tinit: function(opts){\n\t\tvar me = this\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add to To Do'),\n\t\t\tfields: [\n\t\t\t\t{ fieldtype: 'Link', fieldname: 'assign_to', options: 'User', label: __(\"Assign To\"), reqd: true, filters: { 'user_type': 'System User' }},\n\t\t\t\t{ fieldtype: 'Check', fieldname: 'myself', label: __(\"Assign to me\"), \"default\": 0 },\n\t\t\t\t{ fieldtype: 'Small Text', fieldname: 'description', label: __(\"Comment\") },\n\t\t\t\t{ fieldtype: 'Section Break' },\n\t\t\t\t{ fieldtype: 'Column Break' },\n\t\t\t\t{ fieldtype: 'Date', fieldname: 'date', label: __(\"Complete By\") },\n\t\t\t\t{ fieldtype: 'Check', fieldname: 'notify', label: __(\"Notify by Email\") },\n\t\t\t\t{ fieldtype: 'Column Break' },\n\t\t\t\t{ fieldtype: 'Select', fieldname: 'priority', label: __(\"Priority\"),\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ value: 'Low', label: __('Low') },\n\t\t\t\t\t\t{ value: 'Medium', label: __('Medium') },\n\t\t\t\t\t\t{ value: 'High', label: __('High') }\n\t\t\t\t\t],\n\t\t\t\t\t// Pick up priority from the source document, if it exists and is available in ToDo\n\t\t\t\t\t'default': [\"Low\", \"Medium\", \"High\"].includes(opts.obj.frm && opts.obj.frm.doc.priority\n\t\t\t\t\t\t? opts.obj.frm.doc.priority : 'Medium')\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: function() { frappe.ui.add_assignment(opts, this) },\n\t\t\tprimary_action_label: __(\"Add\")\n\t\t})\n\t\t$.extend(me, dialog);\n\n\t\tme.dialog = dialog;\n\n\t\tme.dialog.fields_dict.assign_to.get_query = \"frappe.core.doctype.user.user.user_query\";\n\n\t\tvar myself = me.dialog.get_input(\"myself\").on(\"click\", function() {\n\t\t\tme.toggle_myself(this);\n\t\t});\n\t\tme.toggle_myself(myself);\n\t},\n\ttoggle_myself: function(myself) {\n\t\tvar me = this;\n\t\tif($(myself).prop(\"checked\")) {\n\t\t\tme.dialog.set_value(\"assign_to\", frappe.session.user);\n\t\t\tme.dialog.set_value(\"notify\", 0);\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(false);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(false);\n\t\t} else {\n\t\t\tme.dialog.set_value(\"assign_to\", \"\");\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(true);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(true);\n\t\t}\n\t},\n\n});\n\nfrappe.ui.add_assignment = function(opts, dialog) {\n\tvar assign_to = dialog.fields_dict.assign_to.get_value();\n\tvar args = dialog.get_values();\n\tif(args && assign_to) {\n\t\tdialog.set_message('Assigning...');\n\t\treturn frappe.call({\n\t\t\tmethod: opts.method,\n\t\t\targs: $.extend(args, {\n\t\t\t\tdoctype: opts.doctype,\n\t\t\t\tname: opts.docname,\n\t\t\t\tassign_to: assign_to,\n\t\t\t\tbulk_assign:  opts.bulk_assign || false,\n\t\t\t\tre_assign: opts.re_assign || false\n\t\t\t}),\n\t\t\tbtn: dialog.get_primary_btn(),\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(opts.callback){\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t\t}\n\t\t\t\t\tdialog && dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tdialog.clear_message();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n}\n","frappe.provide('frappe.ui.form');\n\nfrappe.quick_edit = function(doctype, name) {\n\tfrappe.db.get_doc(doctype, name).then(doc => {\n\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, doc);\n\t});\n};\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, '');\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif(frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]){\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](doctype, after_insert, init_callback, doc);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = Class.extend({\n\tinit: function(doctype, after_insert, init_callback, doc) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t},\n\n\tsetup: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.model.with_doctype(this.doctype, function() {\n\t\t\t\tme.set_meta_and_mandatory_fields();\n\t\t\t\tif(me.is_quick_entry()) {\n\t\t\t\t\tme.render_dialog();\n\t\t\t\t\tresolve(me);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe.set_route('Form', me.doctype, me.doc.name)\n\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_meta_and_mandatory_fields: function(){\n\t\tlet fields = frappe.get_meta(this.doctype).fields;\n\t\tif (fields.length < 7) {\n\t\t\t// if less than 7 fields, then show everything\n\t\t\tthis.mandatory = fields;\n\t\t} else {\n\t\t\t// prepare a list of mandatory and bold fields\n\t\t\tthis.mandatory = $.map(fields,\n\t\t\t\tfunction(d) { return ((d.reqd || d.bold || d.allow_in_quick_entry) && !d.read_only) ? $.extend({}, d) : null; });\n\t\t}\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t},\n\n\tis_quick_entry: function(){\n\t\tif(this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.has_child_table()\n\t\t\t|| !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\ttoo_many_mandatory_fields: function(){\n\t\tif(this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\thas_child_table: function(){\n\t\tif($.map(this.mandatory, function(d) {\n\t\t\treturn d.fieldtype==='Table' ? d : null; }).length) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tvalidate_for_prompt_autoname: function(){\n\t\tif(this.meta.autoname && this.meta.autoname.toLowerCase()==='prompt') {\n\t\t\tthis.mandatory = [{fieldname:'__newname', label:__('{0} Name', [this.meta.name]),\n\t\t\t\treqd: 1, fieldtype:'Data'}].concat(this.mandatory);\n\t\t}\n\t},\n\n\trender_dialog: function(){\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t});\n\t\tthis.dialog.doc = this.doc;\n\n\t\tthis.register_primary_action();\n\t\tthis.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => frappe.quick_entry = null;\n\t\tthis.dialog.show();\n\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t},\n\n\tregister_primary_action: function(){\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif(me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.dialog.set_message(__('Saving...'));\n\t\t\t\tme.insert().then(() => {\n\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.save\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif(frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_form_if_not_list: function() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0]==='List' && route[1]===doc.doctype)) {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.set_route('Form', doc.doctype, doc.name)\n\t\t\t]);\n\t\t}\n\t},\n\n\tupdate_doc: function(){\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function(key, value) {\n\t\t\tif(key==='__newname') {\n\t\t\t\tme.dialog.doc.name = value;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t},\n\n\topen_doc: function(){\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t},\n\n\trender_edit_in_full_page_link: function(){\n\t\tvar me = this;\n\t\tvar $link = $('<div style=\"padding-left: 7px; padding-top: 30px; padding-bottom: 10px;\">' +\n\t\t\t'<button class=\"edit-full btn-default btn-sm\">' + __(\"Edit in full page\") + '</button></div>').appendTo(this.dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\tme.open_doc();\n\t\t});\n\t},\n\n\tset_defaults: function(){\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function(fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif(!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n});\n","frappe.provide('frappe.ui.form');\nfrappe.provide('frappe.success_action');\n\nfrappe.ui.form.SuccessAction = class SuccessAction {\n\tconstructor(form) {\n\t\tthis.form = form;\n\t\tthis.load_setting();\n\t}\n\n\tload_setting() {\n\t\tthis.setting = frappe.boot.success_action\n\t\t\t.find(setting => setting.ref_doctype === this.form.doctype);\n\t}\n\n\tshow() {\n\t\tif (!this.setting) return;\n\t\tif (this.form.doc.docstatus === 0 && !this.form.is_first_creation()) return;\n\n\t\tthis.prepare_dom();\n\t\tthis.show_alert();\n\t}\n\n\tprepare_dom() {\n\t\tthis.container = $(document.body).find('.success-container');\n\t\tif (!this.container.length) {\n\t\t\tthis.container = $('<div class=\"success-container\">').appendTo(document.body);\n\t\t}\n\t}\n\n\tshow_alert() {\n\t\tfrappe.db.count(this.form.doctype)\n\t\t\t.then(count => {\n\t\t\t\tconst setting = this.setting;\n\t\t\t\tlet message = count === 1 ?\n\t\t\t\t\tsetting.first_success_message :\n\t\t\t\t\tsetting.message;\n\n\t\t\t\tconst $buttons = this.get_actions().map(action => {\n\t\t\t\t\tconst $btn = $(`<button class=\"next-action\"><span>${action.label}</span></button>`);\n\t\t\t\t\t$btn.click(() => action.action(this.form));\n\t\t\t\t\treturn $btn;\n\t\t\t\t});\n\n\t\t\t\tconst next_action_container = $(`<div class=\"next-action-container\"></div>`);\n\t\t\t\tnext_action_container.append($buttons);\n\t\t\t\tconst html = next_action_container;\n\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tbody: html,\n\t\t\t\t\tindicator: 'green',\n\t\t\t\t}, setting.action_timeout);\n\t\t\t});\n\t}\n\n\tget_actions() {\n\t\tconst actions = [];\n\t\tconst checked_actions = this.setting.next_actions.split(\"\\n\");\n\t\tchecked_actions\n\t\t\t.forEach(action => {\n\t\t\t\tif (typeof action === 'string' && this.default_actions[action]) {\n\t\t\t\t\tactions.push(this.default_actions[action]);\n\t\t\t\t} else if (typeof action === 'object') {\n\t\t\t\t\tactions.push(action);\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn actions;\n\t}\n\n\tget default_actions() {\n\t\treturn {\n\t\t\t'new': {\n\t\t\t\tlabel: __('New'),\n\t\t\t\taction: (frm) => frappe.new_doc(frm.doctype)\n\t\t\t},\n\t\t\t'print': {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: (frm) => frm.print_doc()\n\t\t\t},\n\t\t\t'email': {\n\t\t\t\tlabel: __('Email'),\n\t\t\t\taction: (frm) => frm.email_doc()\n\t\t\t},\n\t\t\t'list': {\n\t\t\t\tlabel: __('View All'),\n\t\t\t\taction: (frm) => {\n\t\t\t\t\tfrappe.set_route('List', frm.doctype);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n};\n","frappe.provide('frappe.model');\nfrappe.provide('frappe.utils');\n\n/**\n * Opens the Website Meta Tag form if it exists for {route}\n * or creates a new doc and opens the form\n */\nfrappe.utils.set_meta_tag = function(route) {\n\tfrappe.db.exists('Website Route Meta', route)\n\t\t.then(exists => {\n\t\t\tif (exists) {\n\t\t\t\tfrappe.set_route('Form', 'Website Route Meta', route);\n\t\t\t} else {\n\t\t\t\t// new doc\n\t\t\t\tconst doc = frappe.model.get_new_doc('Website Route Meta');\n\t\t\t\tdoc.__newname = route;\n\t\t\t\tfrappe.set_route('Form', doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n};\n"],"names":["frappe","provide","ui","form","DocumentFollow","[object Object]","opts","$","extend","this","follow_document_link","parent","find","unfollow_document_link","follow_span","followed_by","followed_by_label","set_followers","render_sidebar","const","docinfo","frm","get_docinfo","document_follow_enabled","boot","user","document_follow_notify","document_can_be_followed","get_meta","doctype","track_changes","session","bind_events","is_document_followed","removeClass","addClass","hide_follow_section","on","call","method","args","doc_name","doc","name","force","callback","r","message","follow_action","unfollow_action","hide","empty","get_followed_user","then","appendTo","html","Promise","resolve","d","count_others","avatar","show_alert","__","indicator","views","FormFactory","Factory","route","me","dt","formview","show_doc","model","with_doctype","page","container","add_page","_f","Frm","initialized","document","close_grid_form","realtime","data","timeline","new_communication","delete_communication","update_communication","set_viewers","dn","slice","join","new_names","set_route","with_doc","locals","load","new_str","substr","length","new_name","make_new_doc_and_get_name","show_not_found","change_to","refresh","Controller","Class","init","frms","in_form","docname","hidden","refresh_if_stale_for","opendocs","custom_buttons","sections","grids","cscript","events","pformat","fetch_dict","tinymce_id_list","setup_meta","event","old_name","rename_notify","prototype","check_doctype_conflict","msgprint","pages","window","location","reload","DocType","setup","fields","fields_dict","state_fieldname","workflow","get_state_fieldname","wrapper","$wrapper","make_app_page","single_column","meta","hide_toolbar","layout_main","main","get","toolbar","Toolbar","setup_print_layout","setup_std_layout","script_manager","ScriptManager","watch_model_updates","footer","Footer","attr","setup_drag_drop","setup_done","e","dataTransfer","originalEvent","files","stopPropagation","preventDefault","__islocal","attachments","max_reached","FileUploader","on_success","file_doc","attachment_uploaded","print_preview","PrintPreview","set_primary_action","print_doc","is","hide_print","can_print","refresh_print_options","trigger","set_view","set_user_lang","set_default_print_language","preview","current_view_name","previous_view_name","fieldname","value","dirty","layout","refresh_dependency","table_fields","get_children","fieldtype","each","i","df","options","parentfield","grid","set_value","form_wrapper","body","section_style","Layout","with_dashboard","make","fields_list","document_flow","DocumentFlow","dashboard","Dashboard","states","States","email_doc","CommunicationComposer","subject","recipients","email","email_id","contact_email","attach_document_print","real_name","contact_display","contact_name","rename_doc","share_doc","shared","show","old","istable","docfield_copy","in_dialog","re_route","hash","encodeURIComponent","get_doc","perm","get_perm","refresh_header","is_a_different_doc","utils","set_title","issingle","current_status","undefined","is_submittable","submit","is_dirty","is_new","has_workflow","docstatus","add_comment","clear_custom_buttons","show_web_link","__onload","is_website_generator","web_link","remove","published","add_web_link","path","label","sidebar","add_user_action","check_doc_perm","parent_doctype","read","scroll_to","forEach","grid_obj","visible_columns","cur_frm","show_not_permitted","read_only","is_read_only","set_read_only","__unsaved","__last_sync_on","Date","reload_doc","is_onload","render_form","localname","setnewdoc","show_print_first","toggleClass","show_if_needs_refresh","__needs_refresh","clear_headline","set_headline_alert","attach_doc_and_docfields","Sidebar","show_message","run_serially","refresh_fields","after_refresh","first","in_list","focus","show_empty_form_message","scroll_to_element","refresh_field","fname","primary_button","cleanup_refresh","amended_from","unhide_field","hide_field","trash_reason","autoname","fn","toggle_display","after_ajax","trigger_link_fields","breadcrumbs","add","module","track_seen","__run_link_triggers","field","runscript","scriptname","callingfield","onrefresh","input","set_working","docs","btn","$input","exc","copy_doc","onload","from_amend","validate_form_action","newdoc","idx","remove_from_locals","validated","Object","defineProperty","console","warn","set","save","save_action","on_error","let","reject","prop","activeElement","blur","setTimeout","_save","show_success_action","catch","error","after_save","indexOf","play_sound","fail","savesubmit","handle_fail","confirm","savecancel","savetrash","delete_doc","history","back","amend_doc","amendment_date","datetime","obj_to_str","alert","disable_save","save_disabled","clear_primary_action","enable_save","save_or_update","reload_docinfo","assign_to","permlevel","access_type","set_intro","txt","color","set_footnote","footnote_area","add_custom_button","group","add_inner_button","clear_inner_toolbar","clear_user_actions","remove_custom_button","remove_inner_button","add_fetch","link_field","src_field","tar_field","columns","push","set_print_heading","action_perm_type_map","Create","Save","Submit","Update","Cancel","Amend","Delete","action","perm_to_check","allowed_for_workflow","perms","throw","has_perm","ptype","route_options","selector","key","repl","get_route","SuccessAction","is_first_creation","modified","split","creation","get_server_fields","arg","table_field","allow_edit","call_back","dom","freeze","isPlainObject","JSON","stringify","$c","unfreeze","field_dict","set_multiple","dict","refresh_many","flist","set_field_tip","n","get_docfield","description","comment_area","innerHTML","replace_newlines","log","filter_dict","docfields","grid_rows_by_docname","set_field_options","set_df_property","set_field_permlevel","level","toggle_field","get_field_obj","set_currency_labels","currency","field_label_map","grid_field_label_map","docfield","docfield_map","replace","trim","set_label","field_map","fnames","keys","l","fieldname1","fieldname2","property","toggle_enable","enable","toggle_reqd","mandatory","reqd","call_server","$c_obj","get_files","sort","get_attachments","set_query","opt1","opt2","get_field","get_query","set_value_if_missing","clear_table","add_child","values","unique_keys","map","includes","if_missing","_set","f","v","fieldobj","has_value","isArray","j","child","tasks","original_callback","get_server_module_name","std_field_list","concat","std_fields_list","docperms","print","cancel","get_formatted","format","no_icon","open_grid_row","get_open_grid_form","get_title","title_field","get_selected","selected","get_table_fields","_selected","has_mapper","_has_mapper","__js","search","set_indicator_formatter","get_color","get_text","every","formatter","link_formatters","escaped_name","can_create","custom_make_buttons","can_make_methods","make_new","make_methods","new_doc","get_new_doc","make_quick_entry","update_in_all_rows","table_fieldname","cl","get_sum","sum","add_update_button_on_dirty","setup_editable_title","make_menu","show_title_as_dirty","hide_menu","print_icon","show_menu","title","strip_html","set_title_sub","$title_area","is_title_editable","can_rename","set_indicator","write","allow_rename","prompt","default","get_dropdown_menu","add_dropdown","get_indicator","clear_indicator","clear_icons","clear_menu","p","cint","print_settings","allow_print_for_draft","allow_print_for_cancelled","add_menu_item","add_action_icon","can_email","show_linked_with","allow_copy","can_delete","user_roles","doc_type","developer_mode","CREATE","can_save","get_docstatus","can_submit","can_update","can_cancel","can_amend","amend","_has_workflow","get_list","document_type","linked_with","LinkedWith","status","get_action_status","set_page_actions","clear_actions","set_secondary_action","click","icon","make_cancel_amend_button","CANCEL","AMEND","clear_actions_menu","section","_form_dashboard","render_template","progress_area","heatmap_area","chart_area","stats_area","stats_area_row","links_area","transactions_area","reset","set_headline","text","alert_class","permanent","clear_comment","add_section","add_progress","percent","progress_chart","make_progress_chart","format_percent","progress","show_progress","_progress_map","progress_bar","css","width","progress_class","hide_progress","init_data","transactions","render_links","set_open_count","heatmap","render_heatmap","graph","setup_graph","__dashboard","internal_links","filter_permissions","add_transactions","group_added","Array","items","ref","can_read","data_rendered","open_document_list","$link","show_open","names","get_document_filter","notifications","show_open_count_list","filter","non_standard_fieldnames","dynamic_links","item","type","timeline_data","update_heatmap","count","set_badge_count","open_count","link","link_fieldname","dashboard_data","update","Chart","scrub","height","start","moment","subtract","toDate","count_label","discreteDomains","margin","heatmap_message","add_indicator","colspan","indicators","n_indicators","graph_method","graph_method_args","render_graph","colors","chart","doctypes","prependTo","render","get_linked_docs","mark_completed_flow","for_doctype","frm_doctype","frm_docname","workflow_state_fieldname","working_label","toTitle","freeze_message","remove_empty_rows","get_all_docs","is_table","cells","is_empty_row","docfield_list","in_list_view","clear_doc","check_mandatory","has_errors","scroll_set","error_fields","folded","unfold","parenttype","bold","scrollTop","offset","top","_call","is_saving","remove_old_form_route","always","update_calling_link","workflow_state","index","current_route","route_history","arr","splice","_from_link","grid_rows","_from_link_scrollY","get_event_handler_list","handlers","on_change","handler","add_handler","off","ControllerClass","event_name","get_handlers","selected_doc","runner","_function","is_old_style","_promise","after_server_call","new_style","old_style","has_handlers","cs","tmp","eval","__custom_js","stack","setup_add_fetch","fetch_from","parts","get_docfields","__css","set_style","log_error","caller","trace","groupEnd","copy_from_first_row","current_row","fieldnames","dialog","make_dialog","Dialog","hide_on_page_refresh","on_page_show","get_linked_doctypes","load_doctypes","links_not_permitted_or_missing","make_html","linked_docs","__linked_docs","linked_doctypes","make_doc_head","make_doc_row","already_loaded","doctypes_to_load","__linked_doctypes","promises","listview_settings","add_fields","all","flag","links","can_get_report","linkinfo","heading","update_fields","get_update_fields","bind","setup_help","add_action_item","state","get_state","workflows","get_transitions","transitions","next_html","allowed","get_document_state","padding","set_default_state","show_actions","added","transition","approval_access","allow_self_approval","owner","xcall","sync","setup_btn","action_added","btn_primary","btn_secondary","default_state","get_default_state","add_view","toggle","has_role","enable_raw_printing","which","target","print_formats","get_print_formats","print_letterhead","print_sel","with_letterhead","multilingual_preview","language_sel","lang_code","val","printer_setting_dialog","print_old_style","printit","new_page_preview_old_style","new_page_preview","open","urllib","get_full_url","selected_format","print_format","get_print_format","is_custom_format","print_format_builder","standard","custom_format","print_format_name","based_on","language","add_options","get_languages","default_print_language","lang","preview_old_style","is_raw_printing","get_print_html","out","$print_format","show_footer","style","print_height","offsetHeight","$message","pixel_to_inches","display","flexDirection","flex-direction","flex","no_letterhead","get_mapped_printer","get_raw_commands","qz_connect","printer_map","raw_commands","config","qz","configs","create","printer","qz_success","err","qz_fail","_lang","print_format_printer_map","get_print_format_printer_map","parse","localStorage","with_old_style","only_body","no_heading","require","_p","build","go","default_print_format","print_format_type","raw_printing","print_css","printer_list","qz_get_printer_list","in_place_edit","get_data","primary_action","printer_mapping","get_values","print_format_list","a","some","primary_action_label","get_print_settings","pdf","letter_head","default_letter_head","defaults","get_default","depends_on","letter_heads","with_letter_head","qz_init","websocket","isActive","connect","assign","retries","delay","toString","version","api","setPromiseType","resolver","setSha256Type","sha256","printers","sidebar_content","comments","user_actions","image_section","image_wrapper","make_assignments","make_attachments","make_review","make_shared","make_viewers","make_tags","make_like","make_follow","setup_user_image_event","like_icon","toggle_like","refresh_like","follow","viewers","tags","_user_tags","full_name","modified_by","comment_when","set_user_image","refresh_comments","get_communications","c","communication_type","comment_type","total_comments","TagEditor","user_tags","Attachments","AssignTo","Share","Viewers","like_wrapper","like_count","setup_like_popover","_liked_by","is_liked","refresh_image","energy_points_enabled","reviews","Review","image_field","image","title_image","cordova","base_url","background-color","get_palette","get_abbr","make_input","users","s","everyone","avatar_class","user_info","fullname","abbr","append","render_shared","onhide","can_share","make_user_input","add_share_button","set_edit_share_events","share_with","make_control","filters","user_type","only_input","render_input","get_value","share","notify","parents","permission_to","found","points","make_review_container","add_review_button","update_reviewers","review_list_wrapper","review_button","review_points","show_review_dialog","popover","content","user_fields","involved_users","communications","sender","delivery_status","versions","assignments","uniqBy","u","Boolean","user_options","get_involved_users","review_dialog","disable_primary_action","to_user","review_type","reason","review","clear","energy_point_logs","unshift","update_points","finally","enable_primary_action","review_logs","review_pill","energy_points","get_points","prepend","setup_detail_popover","el","timestamp","message_parts","Math","abs","animation","placement","template","get_viewers","data_updated","new_users","current","username","new","comma_and","past_viewers","past","new_viewers","viewer","set_docinfo","make_comments","Timeline","new_attachment","add_attachment_wrapper","attachments_label","max_attachments","attachment","add_attachment","file_name","file_url","get_file_url","fileid","$close","file_path","is_private","insertAfter","remove_btn","remove_attachment","can_write","encodeURI","get_file_id_from_file_url","fid","remove_attachment_by_filename","filename","rt","_server_messages","remove_fileid","get_args","from_form","update_attachment","add_to_attachments","form_attachments","new_attachments","separator_element","allow_events_in_timeline","list","mentions","get_names_for_mentions","on_submit","insert_comment","button","setup_email_button","setup_interaction_button","siblings","setup_comment_like","new_communications","more","email_button","is_a_reply","get_recipient","last_email","comment_value","markdown","activity_button","InteractionComposer","$editing_area","editing_area","CommentArea","no_wrapper","destroy","scroll_to_end","last_type","get_view_logs","get_comments","get_energy_point_logs","get_milestones","b","compare_dates","render_timeline_item","communication_date","change","b_date","c_date","prepare_timeline_item","$timeline_item","delete_comment","hasClass","current_editing_area","$edit_btn","$timeline_content","$timeline_edit","make_editing_area","update_comment","communication_medium","add_reply_btn_event","$target","currentTarget","cc","bcc","comment_on_small","comment_on","futur_date","now_datetime","sender_full_name","set_icon_and_color","comment_html","guess_style","strip_original_content","original_content","toggle_blockquote","is_html","content_html","strip_whitespace","match","is_communication_or_comment","user_content","liked_by_user","remove_script_and_style","show_subject","Email","Chat","Phone","SMS","Event","Meeting","ToDo","Submitted","Cancelled","Assigned","Assignment Completed","Comment","Milestone","Workflow","Label","Attachment","Attachment Removed","Shared","Unshared","Like","Edit","Relinked","Reply","icon_fg","with_versions","build_version_comments","cast_comment_as_communication","format_form_log","milestones","get_label","track_field","comment_email","comment_by","comment","get_version_comment","changed","field_display_status","get_field_display_status","ellipsis","html2text","row_changed","row","version_name","reference_doctype","reference_name","email_field","from_recipient","valid_users","allowed_in_mentions","click_toggle_like","communication","communication_exists","index_of_communication","btn_wrapper","info","assign_to_name","_fullname","insertBefore","AssignToDialog","obj","priority","add_assignment","myself","get_input","toggle_myself","set_message","bulk_assign","re_assign","get_primary_btn","clear_message","quick_edit","db","after_insert","init_callback","trimmed_doctype","controller_name","quick_entry","QuickEntryForm","set_meta_and_mandatory_fields","is_quick_entry","render_dialog","allow_in_quick_entry","validate_for_prompt_autoname","has_child_table","too_many_mandatory_fields","toLowerCase","register_primary_action","render_edit_in_full_page_link","keydown","ctrlKey","metaKey","request","ajax_count","set_defaults","working","insert","update_doc","open_form_if_not_list","open_doc","is_null","set_input","load_setting","setting","success_action","ref_doctype","prepare_dom","first_success_message","$buttons","get_actions","$btn","next_action_container","action_timeout","actions","next_actions","default_actions","set_meta_tag","exists","__newname"],"mappings":"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"}